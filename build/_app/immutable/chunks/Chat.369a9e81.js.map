{"version":3,"file":"Chat.369a9e81.js","sources":["../../../../../../node_modules/bits-ui/dist/bits/menu/components/menu-sub.svelte","../../../../../../node_modules/bits-ui/dist/bits/menu/components/menu-sub-content.svelte","../../../../../../node_modules/bits-ui/dist/bits/menu/components/menu-sub-trigger.svelte","../../../../../../src/lib/components/chat/MessageInput/PromptCommands.svelte","../../../../../../src/lib/components/chat/MessageInput/Documents.svelte","../../../../../../src/lib/components/chat/MessageInput/Models.svelte","../../../../../../src/lib/components/icons/XMark.svelte","../../../../../../src/lib/components/icons/DocumentArrowUpSolid.svelte","../../../../../../src/lib/components/icons/GlobeAltSolid.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu.svelte","../../../../../../src/lib/components/chat/MessageInput.svelte","../../../../../../src/lib/components/chat/ModelSelector.svelte","../../../../../../src/lib/components/layout/Navbar/Menu.svelte","../../../../../../src/lib/components/layout/Navbar.svelte","../../../../../../node_modules/eventsource-parser/dist/index.js","../../../../../../node_modules/eventsource-parser/dist/stream.js","../../../../../../src/lib/apis/streaming/index.ts","../../../../../../src/lib/components/common/Banner.svelte","../../../../../../src/lib/components/chat/Chat.svelte"],"sourcesContent":["<script>import { derived } from \"svelte/store\";\nimport { setSubMenuCtx } from \"../ctx.js\";\nexport let disabled = void 0;\nexport let open = void 0;\nexport let onOpenChange = void 0;\nconst {\n  updateOption,\n  ids,\n  states: { subOpen }\n} = setSubMenuCtx({\n  disabled,\n  onOpenChange: ({ next }) => {\n    if (open !== next) {\n      onOpenChange?.(next);\n      open = next;\n    }\n    return next;\n  }\n});\nconst idValues = derived([ids.menu, ids.trigger], ([$menuId, $triggerId]) => ({\n  menu: $menuId,\n  trigger: $triggerId\n}));\n$:\n  open !== void 0 && subOpen.set(open);\n$:\n  updateOption(\"disabled\", disabled);\n</script>\n\n<slot subIds={$idValues} />\n","<script>import { melt } from \"@melt-ui/svelte\";\nimport { createDispatcher } from \"../../../internal/index.js\";\nimport { getSubmenuCtx, updateSubPositioning } from \"../ctx.js\";\nexport let transition = void 0;\nexport let transitionConfig = void 0;\nexport let inTransition = void 0;\nexport let inTransitionConfig = void 0;\nexport let outTransition = void 0;\nexport let outTransitionConfig = void 0;\nexport let asChild = false;\nexport let id = void 0;\nexport let side = \"right\";\nexport let align = \"start\";\nexport let sideOffset = 0;\nexport let alignOffset = 0;\nexport let collisionPadding = 8;\nexport let avoidCollisions = true;\nexport let collisionBoundary = void 0;\nexport let sameWidth = false;\nexport let fitViewport = false;\nexport let strategy = \"absolute\";\nexport let overlap = false;\nexport let el = void 0;\nconst {\n  elements: { subMenu },\n  states: { subOpen },\n  ids,\n  getAttrs\n} = getSubmenuCtx();\nconst dispatch = createDispatcher();\nconst attrs = getAttrs(\"sub-content\");\n$:\n  if (id) {\n    ids.menu.set(id);\n  }\n$:\n  builder = $subMenu;\n$:\n  Object.assign(builder, attrs);\n$:\n  updateSubPositioning({\n    side,\n    align,\n    sideOffset,\n    alignOffset,\n    collisionPadding,\n    avoidCollisions,\n    collisionBoundary,\n    sameWidth,\n    fitViewport,\n    strategy,\n    overlap\n  });\n</script>\n\n{#if asChild && $subOpen}\n\t<slot {builder} />\n{:else if transition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\ttransition:transition={transitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if inTransition && outTransition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\tin:inTransition={inTransitionConfig}\n\t\tout:outTransition={outTransitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if inTransition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\tin:inTransition={inTransitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if outTransition && $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\tout:outTransition={outTransitionConfig}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{:else if $subOpen}\n\t<div\n\t\tbind:this={el}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{/if}\n","<script>import { melt } from \"@melt-ui/svelte\";\nimport { disabledAttrs } from \"../../../internal/index.js\";\nimport { getSubTrigger } from \"../ctx.js\";\nimport { createDispatcher } from \"../../../internal/events.js\";\nexport let disabled = false;\nexport let asChild = false;\nexport let id = void 0;\nexport let el = void 0;\nconst {\n  elements: { subTrigger },\n  ids,\n  getAttrs,\n  options\n} = getSubTrigger();\nconst { disabled: disabledStore } = options;\nconst dispatch = createDispatcher();\n$:\n  if (id) {\n    ids.trigger.set(id);\n  }\n$:\n  builder = $subTrigger;\n$:\n  attrs = {\n    ...getAttrs(\"sub-trigger\"),\n    ...disabledAttrs(disabled || $disabledStore)\n  };\n$:\n  Object.assign(builder, attrs);\n</script>\n\n{#if asChild}\n\t<slot {builder} />\n{:else}\n\t<div\n\t\tbind:this={el}\n\t\t{...builder} use:builder.action\n\t\t{...$$restProps}\n\t\ton:m-click={dispatch}\n\t\ton:m-focusin={dispatch}\n\t\ton:m-focusout={dispatch}\n\t\ton:m-keydown={dispatch}\n\t\ton:m-pointerleave={dispatch}\n\t\ton:m-pointermove={dispatch}\n\t>\n\t\t<slot {builder} />\n\t</div>\n{/if}\n","<script lang=\"ts\">\r\n\timport { prompts } from '$lib/stores';\r\n\timport { findWordIndices } from '$lib/utils';\r\n\timport { tick, getContext } from 'svelte';\r\n\timport { toast } from 'svelte-sonner';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let prompt = '';\r\n\tlet selectedCommandIdx = 0;\r\n\tlet filteredPromptCommands = [];\r\n\r\n\t$: filteredPromptCommands = $prompts\r\n\t\t.filter((p) => p.command.includes(prompt))\r\n\t\t.sort((a, b) => a.title.localeCompare(b.title));\r\n\r\n\t$: if (prompt) {\r\n\t\tselectedCommandIdx = 0;\r\n\t}\r\n\r\n\texport const selectUp = () => {\r\n\t\tselectedCommandIdx = Math.max(0, selectedCommandIdx - 1);\r\n\t};\r\n\r\n\texport const selectDown = () => {\r\n\t\tselectedCommandIdx = Math.min(selectedCommandIdx + 1, filteredPromptCommands.length - 1);\r\n\t};\r\n\r\n\tconst confirmCommand = async (command) => {\r\n\t\tlet text = command.content;\r\n\r\n\t\tif (command.content.includes('{{CLIPBOARD}}')) {\r\n\t\t\tconst clipboardText = await navigator.clipboard.readText().catch((err) => {\r\n\t\t\t\ttoast.error($i18n.t('Failed to read clipboard contents'));\r\n\t\t\t\treturn '{{CLIPBOARD}}';\r\n\t\t\t});\r\n\r\n\t\t\ttext = command.content.replaceAll('{{CLIPBOARD}}', clipboardText);\r\n\t\t}\r\n\r\n\t\tprompt = text;\r\n\r\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\r\n\r\n\t\tawait tick();\r\n\r\n\t\tchatInputElement.style.height = '';\r\n\t\tchatInputElement.style.height = Math.min(chatInputElement.scrollHeight, 200) + 'px';\r\n\r\n\t\tchatInputElement?.focus();\r\n\r\n\t\tawait tick();\r\n\r\n\t\tconst words = findWordIndices(prompt);\r\n\r\n\t\tif (words.length > 0) {\r\n\t\t\tconst word = words.at(0);\r\n\t\t\tchatInputElement.setSelectionRange(word?.startIndex, word.endIndex + 1);\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n{#if filteredPromptCommands.length > 0}\r\n\t<div class=\"md:px-2 mb-3 text-left w-full absolute bottom-0 left-0 right-0\">\r\n\t\t<div class=\"flex w-full px-2\">\r\n\t\t\t<div class=\" bg-gray-100 dark:bg-gray-700 w-10 rounded-l-xl text-center\">\r\n\t\t\t\t<div class=\" text-lg font-semibold mt-2\">/</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"max-h-60 flex flex-col w-full rounded-r-xl bg-white\">\r\n\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5\">\r\n\t\t\t\t\t{#each filteredPromptCommands as command, commandIdx}\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\" px-3 py-1.5 rounded-xl w-full text-left {commandIdx === selectedCommandIdx\r\n\t\t\t\t\t\t\t\t? ' bg-gray-100 selected-command-option-button'\r\n\t\t\t\t\t\t\t\t: ''}\"\r\n\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tconfirmCommand(command);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\ton:mousemove={() => {\r\n\t\t\t\t\t\t\t\tselectedCommandIdx = commandIdx;\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\ton:focus={() => {}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div class=\" font-medium text-black\">\r\n\t\t\t\t\t\t\t\t{command.command}\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600\">\r\n\t\t\t\t\t\t\t\t{command.title}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t{/each}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div\r\n\t\t\t\t\tclass=\" px-2 pb-1 text-xs text-gray-600 bg-white rounded-br-xl flex items-center space-x-1\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\tstroke-width=\"1.5\"\r\n\t\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\t\tclass=\"w-3 h-3\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\r\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\r\n\t\t\t\t\t\t\t\td=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"line-clamp-1\">\r\n\t\t\t\t\t\t{$i18n.t(\r\n\t\t\t\t\t\t\t'Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.'\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n{/if}\r\n","<script lang=\"ts\">\r\n\timport { createEventDispatcher } from 'svelte';\r\n\r\n\timport { documents } from '$lib/stores';\r\n\timport { removeFirstHashWord, isValidHttpUrl } from '$lib/utils';\r\n\timport { tick, getContext } from 'svelte';\r\n\timport { toast } from 'svelte-sonner';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let prompt = '';\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\tlet selectedIdx = 0;\r\n\r\n\tlet filteredItems = [];\r\n\tlet filteredDocs = [];\r\n\r\n\tlet collections = [];\r\n\r\n\t$: collections = [\r\n\t\t...($documents.length > 0\r\n\t\t\t? [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: 'All Documents',\r\n\t\t\t\t\t\ttype: 'collection',\r\n\t\t\t\t\t\ttitle: $i18n.t('All Documents'),\r\n\t\t\t\t\t\tcollection_names: $documents.map((doc) => doc.collection_name)\r\n\t\t\t\t\t}\r\n\t\t\t  ]\r\n\t\t\t: []),\r\n\t\t...$documents\r\n\t\t\t.reduce((a, e, i, arr) => {\r\n\t\t\t\treturn [...new Set([...a, ...(e?.content?.tags ?? []).map((tag) => tag.name)])];\r\n\t\t\t}, [])\r\n\t\t\t.map((tag) => ({\r\n\t\t\t\tname: tag,\r\n\t\t\t\ttype: 'collection',\r\n\t\t\t\tcollection_names: $documents\r\n\t\t\t\t\t.filter((doc) => (doc?.content?.tags ?? []).map((tag) => tag.name).includes(tag))\r\n\t\t\t\t\t.map((doc) => doc.collection_name)\r\n\t\t\t}))\r\n\t];\r\n\r\n\t$: filteredCollections = collections\r\n\t\t.filter((collection) => collection.name.includes(prompt.split(' ')?.at(0)?.substring(1) ?? ''))\r\n\t\t.sort((a, b) => a.name.localeCompare(b.name));\r\n\r\n\t$: filteredDocs = $documents\r\n\t\t.filter((doc) => doc.name.includes(prompt.split(' ')?.at(0)?.substring(1) ?? ''))\r\n\t\t.sort((a, b) => a.title.localeCompare(b.title));\r\n\r\n\t$: filteredItems = [...filteredCollections, ...filteredDocs];\r\n\r\n\t$: if (prompt) {\r\n\t\tselectedIdx = 0;\r\n\r\n\t\tconsole.log(filteredCollections);\r\n\t}\r\n\r\n\texport const selectUp = () => {\r\n\t\tselectedIdx = Math.max(0, selectedIdx - 1);\r\n\t};\r\n\r\n\texport const selectDown = () => {\r\n\t\tselectedIdx = Math.min(selectedIdx + 1, filteredItems.length - 1);\r\n\t};\r\n\r\n\tconst confirmSelect = async (doc) => {\r\n\t\tdispatch('select', doc);\r\n\r\n\t\tprompt = removeFirstHashWord(prompt);\r\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\r\n\r\n\t\tawait tick();\r\n\t\tchatInputElement?.focus();\r\n\t\tawait tick();\r\n\t};\r\n\r\n\tconst confirmSelectWeb = async (url) => {\r\n\t\tdispatch('url', url);\r\n\r\n\t\tprompt = removeFirstHashWord(prompt);\r\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\r\n\r\n\t\tawait tick();\r\n\t\tchatInputElement?.focus();\r\n\t\tawait tick();\r\n\t};\r\n\r\n\tconst confirmSelectYoutube = async (url) => {\r\n\t\tdispatch('youtube', url);\r\n\r\n\t\tprompt = removeFirstHashWord(prompt);\r\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\r\n\r\n\t\tawait tick();\r\n\t\tchatInputElement?.focus();\r\n\t\tawait tick();\r\n\t};\r\n</script>\r\n\r\n{#if filteredItems.length > 0 || prompt.split(' ')?.at(0)?.substring(1).startsWith('http')}\r\n\t<div class=\"md:px-2 mb-3 text-left w-full absolute bottom-0 left-0 right-0\">\r\n\t\t<div class=\"flex w-full px-2\">\r\n\t\t\t<div class=\" bg-gray-100 dark:bg-gray-700 w-10 rounded-l-xl text-center\">\r\n\t\t\t\t<div class=\" text-lg font-semibold mt-2\">#</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"max-h-60 flex flex-col w-full rounded-r-xl bg-white\">\r\n\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5\">\r\n\t\t\t\t\t{#each filteredItems as doc, docIdx}\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\" px-3 py-1.5 rounded-xl w-full text-left {docIdx === selectedIdx\r\n\t\t\t\t\t\t\t\t? ' bg-gray-100 selected-command-option-button'\r\n\t\t\t\t\t\t\t\t: ''}\"\r\n\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tconsole.log(doc);\r\n\r\n\t\t\t\t\t\t\t\tconfirmSelect(doc);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\ton:mousemove={() => {\r\n\t\t\t\t\t\t\t\tselectedIdx = docIdx;\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\ton:focus={() => {}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{#if doc.type === 'collection'}\r\n\t\t\t\t\t\t\t\t<div class=\" font-medium text-black line-clamp-1\">\r\n\t\t\t\t\t\t\t\t\t{doc?.title ?? `#${doc.name}`}\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 line-clamp-1\">{$i18n.t('Collection')}</div>\r\n\t\t\t\t\t\t\t{:else}\r\n\t\t\t\t\t\t\t\t<div class=\" font-medium text-black line-clamp-1\">\r\n\t\t\t\t\t\t\t\t\t#{doc.name} ({doc.filename})\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 line-clamp-1\">\r\n\t\t\t\t\t\t\t\t\t{doc.title}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t{/each}\r\n\r\n\t\t\t\t\t{#if prompt\r\n\t\t\t\t\t\t.split(' ')\r\n\t\t\t\t\t\t.some((s) => s.substring(1).startsWith('https://www.youtube.com') || s\r\n\t\t\t\t\t\t\t\t\t.substring(1)\r\n\t\t\t\t\t\t\t\t\t.startsWith('https://youtu.be'))}\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\"px-3 py-1.5 rounded-xl w-full text-left bg-gray-100 selected-command-option-button\"\r\n\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tconst url = prompt.split(' ')?.at(0)?.substring(1);\r\n\t\t\t\t\t\t\t\tif (isValidHttpUrl(url)) {\r\n\t\t\t\t\t\t\t\t\tconfirmSelectYoutube(url);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttoast.error(\r\n\t\t\t\t\t\t\t\t\t\t$i18n.t(\r\n\t\t\t\t\t\t\t\t\t\t\t'Oops! Looks like the URL is invalid. Please double-check and try again.'\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div class=\" font-medium text-black line-clamp-1\">\r\n\t\t\t\t\t\t\t\t{prompt.split(' ')?.at(0)?.substring(1)}\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 line-clamp-1\">{$i18n.t('Youtube')}</div>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t{:else if prompt.split(' ')?.at(0)?.substring(1).startsWith('http')}\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\"px-3 py-1.5 rounded-xl w-full text-left bg-gray-100 selected-command-option-button\"\r\n\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tconst url = prompt.split(' ')?.at(0)?.substring(1);\r\n\t\t\t\t\t\t\t\tif (isValidHttpUrl(url)) {\r\n\t\t\t\t\t\t\t\t\tconfirmSelectWeb(url);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttoast.error(\r\n\t\t\t\t\t\t\t\t\t\t$i18n.t(\r\n\t\t\t\t\t\t\t\t\t\t\t'Oops! Looks like the URL is invalid. Please double-check and try again.'\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div class=\" font-medium text-black line-clamp-1\">\r\n\t\t\t\t\t\t\t\t{prompt.split(' ')?.at(0)?.substring(1)}\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 line-clamp-1\">{$i18n.t('Web')}</div>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t{/if}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n{/if}\r\n","<script lang=\"ts\">\r\n\timport { createEventDispatcher } from 'svelte';\r\n\r\n\timport { generatePrompt } from '$lib/apis/ollama';\r\n\timport { models } from '$lib/stores';\r\n\timport { splitStream } from '$lib/utils';\r\n\timport { tick, getContext } from 'svelte';\r\n\timport { toast } from 'svelte-sonner';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\texport let prompt = '';\r\n\texport let user = null;\r\n\r\n\texport let chatInputPlaceholder = '';\r\n\texport let messages = [];\r\n\r\n\tlet selectedIdx = 0;\r\n\tlet filteredModels = [];\r\n\r\n\t$: filteredModels = $models\r\n\t\t.filter((p) => p.name.includes(prompt.split(' ')?.at(0)?.substring(1) ?? ''))\r\n\t\t.sort((a, b) => a.name.localeCompare(b.name));\r\n\r\n\t$: if (prompt) {\r\n\t\tselectedIdx = 0;\r\n\t}\r\n\r\n\texport const selectUp = () => {\r\n\t\tselectedIdx = Math.max(0, selectedIdx - 1);\r\n\t};\r\n\r\n\texport const selectDown = () => {\r\n\t\tselectedIdx = Math.min(selectedIdx + 1, filteredModels.length - 1);\r\n\t};\r\n\r\n\tconst confirmSelect = async (model) => {\r\n\t\tprompt = '';\r\n\t\tdispatch('select', model);\r\n\t};\r\n\r\n\tconst confirmSelectCollaborativeChat = async (model) => {\r\n\t\t// dispatch('select', model);\r\n\t\tprompt = '';\r\n\t\tuser = JSON.parse(JSON.stringify(model.name));\r\n\t\tawait tick();\r\n\r\n\t\tchatInputPlaceholder = $i18n.t('{{modelName}} is thinking...', { modelName: model.name });\r\n\r\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\r\n\r\n\t\tawait tick();\r\n\t\tchatInputElement?.focus();\r\n\t\tawait tick();\r\n\r\n\t\tconst convoText = messages.reduce((a, message, i, arr) => {\r\n\t\t\treturn `${a}### ${message.role.toUpperCase()}\\n${message.content}\\n\\n`;\r\n\t\t}, '');\r\n\r\n\t\tconst res = await generatePrompt(localStorage.token, model.name, convoText);\r\n\r\n\t\tif (res && res.ok) {\r\n\t\t\tconst reader = res.body\r\n\t\t\t\t.pipeThrough(new TextDecoderStream())\r\n\t\t\t\t.pipeThrough(splitStream('\\n'))\r\n\t\t\t\t.getReader();\r\n\r\n\t\t\twhile (true) {\r\n\t\t\t\tconst { value, done } = await reader.read();\r\n\t\t\t\tif (done) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet lines = value.split('\\n');\r\n\r\n\t\t\t\t\tfor (const line of lines) {\r\n\t\t\t\t\t\tif (line !== '') {\r\n\t\t\t\t\t\t\tconsole.log(line);\r\n\t\t\t\t\t\t\tlet data = JSON.parse(line);\r\n\r\n\t\t\t\t\t\t\tif ('detail' in data) {\r\n\t\t\t\t\t\t\t\tthrow data;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif ('id' in data) {\r\n\t\t\t\t\t\t\t\tconsole.log(data);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (data.done == false) {\r\n\t\t\t\t\t\t\t\t\tif (prompt == '' && data.response == '\\n') {\r\n\t\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tprompt += data.response;\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(data.response);\r\n\t\t\t\t\t\t\t\t\t\tchatInputElement.scrollTop = chatInputElement.scrollHeight;\r\n\t\t\t\t\t\t\t\t\t\tawait tick();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.log(error);\r\n\t\t\t\t\tif ('detail' in error) {\r\n\t\t\t\t\t\ttoast.error(error.detail);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (res !== null) {\r\n\t\t\t\tconst error = await res.json();\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t\tif ('detail' in error) {\r\n\t\t\t\t\ttoast.error(error.detail);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoast.error(error.error);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttoast.error(\r\n\t\t\t\t\t$i18n.t('Uh-oh! There was an issue connecting to {{provider}}.', { provider: 'llama' })\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tchatInputPlaceholder = '';\r\n\r\n\t\tconsole.log(user);\r\n\t};\r\n</script>\r\n\r\n{#if prompt.charAt(0) === '@'}\r\n\t{#if filteredModels.length > 0}\r\n\t\t<div class=\"md:px-2 mb-3 text-left w-full absolute bottom-0 left-0 right-0\">\r\n\t\t\t<div class=\"flex w-full px-2\">\r\n\t\t\t\t<div class=\" bg-gray-100 dark:bg-gray-700 w-10 rounded-l-xl text-center\">\r\n\t\t\t\t\t<div class=\" text-lg font-semibold mt-2\">@</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"max-h-60 flex flex-col w-full rounded-r-xl bg-white\">\r\n\t\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5\">\r\n\t\t\t\t\t\t{#each filteredModels as model, modelIdx}\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tclass=\" px-3 py-1.5 rounded-xl w-full text-left {modelIdx === selectedIdx\r\n\t\t\t\t\t\t\t\t\t? ' bg-gray-100 selected-command-option-button'\r\n\t\t\t\t\t\t\t\t\t: ''}\"\r\n\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\t\tconfirmSelect(model);\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\ton:mousemove={() => {\r\n\t\t\t\t\t\t\t\t\tselectedIdx = modelIdx;\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\ton:focus={() => {}}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<div class=\" font-medium text-black line-clamp-1\">\r\n\t\t\t\t\t\t\t\t\t{model.name}\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t<!-- <div class=\" text-xs text-gray-600 line-clamp-1\">\r\n\t\t\t\t\t\t\t\t{doc.title}\r\n\t\t\t\t\t\t\t</div> -->\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t{/each}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t{/if}\r\n{/if}\r\n","<script lang=\"ts\">\r\n\texport let className = 'size-3.5';\r\n\texport let strokeWidth = '2';\r\n</script>\r\n\r\n<svg\r\n\txmlns=\"http://www.w3.org/2000/svg\"\r\n\tfill=\"none\"\r\n\tviewBox=\"0 0 24 24\"\r\n\tstroke-width={strokeWidth}\r\n\tstroke=\"currentColor\"\r\n\tclass={className}\r\n>\r\n\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6 18 18 6M6 6l12 12\" />\r\n</svg>\r\n","<script lang=\"ts\">\r\n\texport let className = 'size-4';\r\n</script>\r\n\r\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\r\n\t<path\r\n\t\tfill-rule=\"evenodd\"\r\n\t\td=\"M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875Zm6.905 9.97a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.72-1.72V18a.75.75 0 0 0 1.5 0v-4.19l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z\"\r\n\t\tclip-rule=\"evenodd\"\r\n\t/>\r\n\t<path\r\n\t\td=\"M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z\"\r\n\t/>\r\n</svg>\r\n","<script lang=\"ts\">\r\n\texport let className = 'size-4';\r\n</script>\r\n\r\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\r\n\t<path\r\n\t\td=\"M21.721 12.752a9.711 9.711 0 0 0-.945-5.003 12.754 12.754 0 0 1-4.339 2.708 18.991 18.991 0 0 1-.214 4.772 17.165 17.165 0 0 0 5.498-2.477ZM14.634 15.55a17.324 17.324 0 0 0 .332-4.647c-.952.227-1.945.347-2.966.347-1.021 0-2.014-.12-2.966-.347a17.515 17.515 0 0 0 .332 4.647 17.385 17.385 0 0 0 5.268 0ZM9.772 17.119a18.963 18.963 0 0 0 4.456 0A17.182 17.182 0 0 1 12 21.724a17.18 17.18 0 0 1-2.228-4.605ZM7.777 15.23a18.87 18.87 0 0 1-.214-4.774 12.753 12.753 0 0 1-4.34-2.708 9.711 9.711 0 0 0-.944 5.004 17.165 17.165 0 0 0 5.498 2.477ZM21.356 14.752a9.765 9.765 0 0 1-7.478 6.817 18.64 18.64 0 0 0 1.988-4.718 18.627 18.627 0 0 0 5.49-2.098ZM2.644 14.752c1.682.971 3.53 1.688 5.49 2.099a18.64 18.64 0 0 0 1.988 4.718 9.765 9.765 0 0 1-7.478-6.816ZM13.878 2.43a9.755 9.755 0 0 1 6.116 3.986 11.267 11.267 0 0 1-3.746 2.504 18.63 18.63 0 0 0-2.37-6.49ZM12 2.276a17.152 17.152 0 0 1 2.805 7.121c-.897.23-1.837.353-2.805.353-.968 0-1.908-.122-2.805-.353A17.151 17.151 0 0 1 12 2.276ZM10.122 2.43a18.629 18.629 0 0 0-2.37 6.49 11.266 11.266 0 0 1-3.746-2.504 9.754 9.754 0 0 1 6.116-3.985Z\"\r\n\t/>\r\n</svg>\r\n","<script lang=\"ts\">\r\n\timport { DropdownMenu } from 'bits-ui';\r\n\timport { flyAndScale } from '$lib/utils/transitions';\r\n\timport { getContext } from 'svelte';\r\n\r\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\r\n\timport GarbageBin from '$lib/components/icons/GarbageBin.svelte';\r\n\timport Pencil from '$lib/components/icons/Pencil.svelte';\r\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\r\n\timport Tags from '$lib/components/chat/Tags.svelte';\r\n\timport Share from '$lib/components/icons/Share.svelte';\r\n\timport ArchiveBox from '$lib/components/icons/ArchiveBox.svelte';\r\n\timport DocumentArrowUpSolid from '$lib/components/icons/DocumentArrowUpSolid.svelte';\r\n\timport Switch from '$lib/components/common/Switch.svelte';\r\n\timport GlobeAltSolid from '$lib/components/icons/GlobeAltSolid.svelte';\r\n\timport { config } from '$lib/stores';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let uploadFilesHandler: Function;\r\n\texport let webSearchEnabled: boolean;\r\n\r\n\texport let onClose: Function;\r\n\r\n\tlet show = false;\r\n</script>\r\n\r\n<Dropdown\r\n\tbind:show\r\n\ton:change={(e) => {\r\n\t\tif (e.detail === false) {\r\n\t\t\tonClose();\r\n\t\t}\r\n\t}}\r\n>\r\n\t<Tooltip content={$i18n.t('More')}>\r\n\t\t<slot />\r\n\t</Tooltip>\r\n\r\n\t<div slot=\"content\">\r\n\t\t<DropdownMenu.Content\r\n\t\t\tclass=\"w-full max-w-[190px] rounded-xl px-1 py-1  border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow\"\r\n\t\t\tsideOffset={15}\r\n\t\t\talignOffset={-8}\r\n\t\t\tside=\"top\"\r\n\t\t\talign=\"start\"\r\n\t\t\ttransition={flyAndScale}\r\n\t\t>\r\n\t\t\t{#if $config?.features?.enable_web_search}\r\n\t\t\t\t<div\r\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<div class=\"flex-1 flex items-center gap-2\">\r\n\t\t\t\t\t\t<GlobeAltSolid />\r\n\t\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Web Search')}</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<Switch bind:state={webSearchEnabled} />\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<hr class=\"border-gray-100 dark:border-gray-800 my-1\" />\r\n\t\t\t{/if}\r\n\r\n\t\t\t<DropdownMenu.Item\r\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl\"\r\n\t\t\t\ton:click={() => {\r\n\t\t\t\t\tuploadFilesHandler();\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<DocumentArrowUpSolid />\r\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Upload Files')}</div>\r\n\t\t\t</DropdownMenu.Item>\r\n\t\t</DropdownMenu.Content>\r\n\t</div>\r\n</Dropdown>\r\n","<script lang=\"ts\">\r\n\timport { toast } from 'svelte-sonner';\r\n\timport { onMount, tick, getContext } from 'svelte';\r\n\timport { type Model, mobile, settings, showSidebar, models, config } from '$lib/stores';\r\n\timport { blobToFile, calculateSHA256, findWordIndices } from '$lib/utils';\r\n\r\n\timport {\r\n\t\tuploadDocToVectorDB,\r\n\t\tuploadWebToVectorDB,\r\n\t\tuploadYoutubeTranscriptionToVectorDB\r\n\t} from '$lib/apis/rag';\r\n\timport { SUPPORTED_FILE_TYPE, SUPPORTED_FILE_EXTENSIONS, WEBUI_BASE_URL } from '$lib/constants';\r\n\r\n\timport { transcribeAudio } from '$lib/apis/audio';\r\n\r\n\timport Prompts from './MessageInput/PromptCommands.svelte';\r\n\timport Suggestions from './MessageInput/Suggestions.svelte';\r\n\timport AddFilesPlaceholder from '../AddFilesPlaceholder.svelte';\r\n\timport Documents from './MessageInput/Documents.svelte';\r\n\timport Models from './MessageInput/Models.svelte';\r\n\timport Tooltip from '../common/Tooltip.svelte';\r\n\timport XMark from '$lib/components/icons/XMark.svelte';\r\n\timport InputMenu from './MessageInput/InputMenu.svelte';\r\n\timport { t } from 'i18next';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let submitPrompt: Function;\r\n\texport let stopResponse: Function;\r\n\r\n\texport let autoScroll = true;\r\n\r\n\texport let atSelectedModel: Model | undefined;\r\n\texport let selectedModels: [''];\r\n\r\n\tlet chatTextAreaElement: HTMLTextAreaElement;\r\n\tlet filesInputElement;\r\n\r\n\tlet promptsElement;\r\n\tlet documentsElement;\r\n\tlet modelsElement;\r\n\r\n\tlet inputFiles;\r\n\tlet dragged = false;\r\n\r\n\tlet user = null;\r\n\tlet chatInputPlaceholder = '';\r\n\r\n\texport let files = [];\r\n\r\n\texport let speechRecognitionEnabled = true;\r\n\texport let webSearchEnabled = false;\r\n\r\n\texport let prompt = '';\r\n\texport let messages = [];\r\n\r\n\tlet speechRecognition;\r\n\r\n\tlet visionCapableModels = [];\r\n\t$: visionCapableModels = [...(atSelectedModel ? [atSelectedModel] : selectedModels)].filter(\r\n\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.vision ?? true\r\n\t);\r\n\r\n\t$: if (prompt) {\r\n\t\tif (chatTextAreaElement) {\r\n\t\t\tchatTextAreaElement.style.height = '';\r\n\t\t\tchatTextAreaElement.style.height = Math.min(chatTextAreaElement.scrollHeight, 200) + 'px';\r\n\t\t}\r\n\t}\r\n\r\n\tlet mediaRecorder;\r\n\tlet audioChunks = [];\r\n\tlet isRecording = false;\r\n\tconst MIN_DECIBELS = -45;\r\n\r\n\tconst scrollToBottom = () => {\r\n\t\tconst element = document.getElementById('messages-container');\r\n\t\telement.scrollTop = element.scrollHeight;\r\n\t};\r\n\r\n\tconst startRecording = async () => {\r\n\t\tconst stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n\t\tmediaRecorder = new MediaRecorder(stream);\r\n\t\tmediaRecorder.onstart = () => {\r\n\t\t\tisRecording = true;\r\n\t\t\tconsole.log('Recording started');\r\n\t\t};\r\n\t\tmediaRecorder.ondataavailable = (event) => audioChunks.push(event.data);\r\n\t\tmediaRecorder.onstop = async () => {\r\n\t\t\tisRecording = false;\r\n\t\t\tconsole.log('Recording stopped');\r\n\r\n\t\t\t// Create a blob from the audio chunks\r\n\t\t\tconst audioBlob = new Blob(audioChunks, { type: 'audio/wav' });\r\n\r\n\t\t\tconst file = blobToFile(audioBlob, 'recording.wav');\r\n\r\n\t\t\tconst res = await transcribeAudio(localStorage.token, file).catch((error) => {\r\n\t\t\t\ttoast.error(error);\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\r\n\t\t\tif (res) {\r\n\t\t\t\tprompt = res.text;\r\n\t\t\t\tawait tick();\r\n\t\t\t\tchatTextAreaElement?.focus();\r\n\r\n\t\t\t\tif (prompt !== '' && $settings?.speechAutoSend === true) {\r\n\t\t\t\t\tsubmitPrompt(prompt, user);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// saveRecording(audioBlob);\r\n\t\t\taudioChunks = [];\r\n\t\t};\r\n\r\n\t\t// Start recording\r\n\t\tmediaRecorder.start();\r\n\r\n\t\t// Monitor silence\r\n\t\tmonitorSilence(stream);\r\n\t};\r\n\r\n\tconst monitorSilence = (stream) => {\r\n\t\tconst audioContext = new AudioContext();\r\n\t\tconst audioStreamSource = audioContext.createMediaStreamSource(stream);\r\n\t\tconst analyser = audioContext.createAnalyser();\r\n\t\tanalyser.minDecibels = MIN_DECIBELS;\r\n\t\taudioStreamSource.connect(analyser);\r\n\r\n\t\tconst bufferLength = analyser.frequencyBinCount;\r\n\t\tconst domainData = new Uint8Array(bufferLength);\r\n\r\n\t\tlet lastSoundTime = Date.now();\r\n\r\n\t\tconst detectSound = () => {\r\n\t\t\tanalyser.getByteFrequencyData(domainData);\r\n\r\n\t\t\tif (domainData.some((value) => value > 0)) {\r\n\t\t\t\tlastSoundTime = Date.now();\r\n\t\t\t}\r\n\r\n\t\t\tif (isRecording && Date.now() - lastSoundTime > 3000) {\r\n\t\t\t\tmediaRecorder.stop();\r\n\t\t\t\taudioContext.close();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\twindow.requestAnimationFrame(detectSound);\r\n\t\t};\r\n\r\n\t\twindow.requestAnimationFrame(detectSound);\r\n\t};\r\n\r\n\tconst saveRecording = (blob) => {\r\n\t\tconst url = URL.createObjectURL(blob);\r\n\t\tconst a = document.createElement('a');\r\n\t\tdocument.body.appendChild(a);\r\n\t\ta.style = 'display: none';\r\n\t\ta.href = url;\r\n\t\ta.download = 'recording.wav';\r\n\t\ta.click();\r\n\t\twindow.URL.revokeObjectURL(url);\r\n\t};\r\n\r\n\tconst speechRecognitionHandler = () => {\r\n\t\t// Check if SpeechRecognition is supported\r\n\r\n\t\tif (isRecording) {\r\n\t\t\tif (speechRecognition) {\r\n\t\t\t\tspeechRecognition.stop();\r\n\t\t\t}\r\n\r\n\t\t\tif (mediaRecorder) {\r\n\t\t\t\tmediaRecorder.stop();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tisRecording = true;\r\n\r\n\t\t\tif ($settings?.audio?.STTEngine ?? '' !== '') {\r\n\t\t\t\tstartRecording();\r\n\t\t\t} else {\r\n\t\t\t\tif ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {\r\n\t\t\t\t\t// Create a SpeechRecognition object\r\n\t\t\t\t\tspeechRecognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();\r\n\r\n\t\t\t\t\t// Set continuous to true for continuous recognition\r\n\t\t\t\t\tspeechRecognition.continuous = true;\r\n\r\n\t\t\t\t\t// Set the timeout for turning off the recognition after inactivity (in milliseconds)\r\n\t\t\t\t\tconst inactivityTimeout = 3000; // 3 seconds\r\n\r\n\t\t\t\t\tlet timeoutId;\r\n\t\t\t\t\t// Start recognition\r\n\t\t\t\t\tspeechRecognition.start();\r\n\r\n\t\t\t\t\t// Event triggered when speech is recognized\r\n\t\t\t\t\tspeechRecognition.onresult = async (event) => {\r\n\t\t\t\t\t\t// Clear the inactivity timeout\r\n\t\t\t\t\t\tclearTimeout(timeoutId);\r\n\r\n\t\t\t\t\t\t// Handle recognized speech\r\n\t\t\t\t\t\tconsole.log(event);\r\n\t\t\t\t\t\tconst transcript = event.results[Object.keys(event.results).length - 1][0].transcript;\r\n\r\n\t\t\t\t\t\tprompt = `${prompt}${transcript}`;\r\n\r\n\t\t\t\t\t\tawait tick();\r\n\t\t\t\t\t\tchatTextAreaElement?.focus();\r\n\r\n\t\t\t\t\t\t// Restart the inactivity timeout\r\n\t\t\t\t\t\ttimeoutId = setTimeout(() => {\r\n\t\t\t\t\t\t\tconsole.log('Speech recognition turned off due to inactivity.');\r\n\t\t\t\t\t\t\tspeechRecognition.stop();\r\n\t\t\t\t\t\t}, inactivityTimeout);\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Event triggered when recognition is ended\r\n\t\t\t\t\tspeechRecognition.onend = function () {\r\n\t\t\t\t\t\t// Restart recognition after it ends\r\n\t\t\t\t\t\tconsole.log('recognition ended');\r\n\t\t\t\t\t\tisRecording = false;\r\n\t\t\t\t\t\tif (prompt !== '' && $settings?.speechAutoSend === true) {\r\n\t\t\t\t\t\t\tsubmitPrompt(prompt, user);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Event triggered when an error occurs\r\n\t\t\t\t\tspeechRecognition.onerror = function (event) {\r\n\t\t\t\t\t\tconsole.log(event);\r\n\t\t\t\t\t\ttoast.error($i18n.t(`Speech recognition error: {{error}}`, { error: event.error }));\r\n\t\t\t\t\t\tisRecording = false;\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoast.error($i18n.t('SpeechRecognition API is not supported in this browser.'));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst uploadDoc = async (file) => {\r\n\t\tconsole.log(file);\r\n\r\n\t\tconst doc = {\r\n\t\t\ttype: 'doc',\r\n\t\t\tname: file.name,\r\n\t\t\tcollection_name: '',\r\n\t\t\tupload_status: false,\r\n\t\t\terror: ''\r\n\t\t};\r\n\r\n\t\ttry {\r\n\t\t\tfiles = [...files, doc];\r\n\r\n\t\t\tif (['audio/mpeg', 'audio/wav'].includes(file['type'])) {\r\n\t\t\t\tconst res = await transcribeAudio(localStorage.token, file).catch((error) => {\r\n\t\t\t\t\ttoast.error(error);\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (res) {\r\n\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\tconst blob = new Blob([res.text], { type: 'text/plain' });\r\n\t\t\t\t\tfile = blobToFile(blob, `${file.name}.txt`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst res = await uploadDocToVectorDB(localStorage.token, '', file);\r\n\r\n\t\t\tif (res) {\r\n\t\t\t\tdoc.upload_status = true;\r\n\t\t\t\tdoc.collection_name = res.collection_name;\r\n\t\t\t\tfiles = files;\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\t// Remove the failed doc from the files array\r\n\t\t\tfiles = files.filter((f) => f.name !== file.name);\r\n\t\t\ttoast.error(e);\r\n\t\t}\r\n\t};\r\n\r\n\tconst uploadWeb = async (url) => {\r\n\t\tconsole.log(url);\r\n\r\n\t\tconst doc = {\r\n\t\t\ttype: 'doc',\r\n\t\t\tname: url,\r\n\t\t\tcollection_name: '',\r\n\t\t\tupload_status: false,\r\n\t\t\turl: url,\r\n\t\t\terror: ''\r\n\t\t};\r\n\r\n\t\ttry {\r\n\t\t\tfiles = [...files, doc];\r\n\t\t\tconst res = await uploadWebToVectorDB(localStorage.token, '', url);\r\n\r\n\t\t\tif (res) {\r\n\t\t\t\tdoc.upload_status = true;\r\n\t\t\t\tdoc.collection_name = res.collection_name;\r\n\t\t\t\tfiles = files;\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\t// Remove the failed doc from the files array\r\n\t\t\tfiles = files.filter((f) => f.name !== url);\r\n\t\t\ttoast.error(e);\r\n\t\t}\r\n\t};\r\n\r\n\tconst uploadYoutubeTranscription = async (url) => {\r\n\t\tconsole.log(url);\r\n\r\n\t\tconst doc = {\r\n\t\t\ttype: 'doc',\r\n\t\t\tname: url,\r\n\t\t\tcollection_name: '',\r\n\t\t\tupload_status: false,\r\n\t\t\turl: url,\r\n\t\t\terror: ''\r\n\t\t};\r\n\r\n\t\ttry {\r\n\t\t\tfiles = [...files, doc];\r\n\t\t\tconst res = await uploadYoutubeTranscriptionToVectorDB(localStorage.token, url);\r\n\r\n\t\t\tif (res) {\r\n\t\t\t\tdoc.upload_status = true;\r\n\t\t\t\tdoc.collection_name = res.collection_name;\r\n\t\t\t\tfiles = files;\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\t// Remove the failed doc from the files array\r\n\t\t\tfiles = files.filter((f) => f.name !== url);\r\n\t\t\ttoast.error(e);\r\n\t\t}\r\n\t};\r\n\r\n\tonMount(() => {\r\n\t\twindow.setTimeout(() => chatTextAreaElement?.focus(), 0);\r\n\r\n\t\tconst dropZone = document.querySelector('body');\r\n\r\n\t\tconst handleKeyDown = (event: KeyboardEvent) => {\r\n\t\t\tif (event.key === 'Escape') {\r\n\t\t\t\tconsole.log('Escape');\r\n\t\t\t\tdragged = false;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tconst onDragOver = (e) => {\r\n\t\t\te.preventDefault();\r\n\t\t\tdragged = true;\r\n\t\t};\r\n\r\n\t\tconst onDragLeave = () => {\r\n\t\t\tdragged = false;\r\n\t\t};\r\n\r\n\t\tconst onDrop = async (e) => {\r\n\t\t\te.preventDefault();\r\n\t\t\tconsole.log(e);\r\n\r\n\t\t\tif (e.dataTransfer?.files) {\r\n\t\t\t\tconst inputFiles = Array.from(e.dataTransfer?.files);\r\n\r\n\t\t\t\tif (inputFiles && inputFiles.length > 0) {\r\n\t\t\t\t\tinputFiles.forEach((file) => {\r\n\t\t\t\t\t\tconsole.log(file, file.name.split('.').at(-1));\r\n\t\t\t\t\t\tif (['image/gif', 'image/webp', 'image/jpeg', 'image/png'].includes(file['type'])) {\r\n\t\t\t\t\t\t\tif (visionCapableModels.length === 0) {\r\n\t\t\t\t\t\t\t\ttoast.error($i18n.t('Selected model(s) do not support image inputs'));\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet reader = new FileReader();\r\n\t\t\t\t\t\t\treader.onload = (event) => {\r\n\t\t\t\t\t\t\t\tfiles = [\r\n\t\t\t\t\t\t\t\t\t...files,\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\ttype: 'image',\r\n\t\t\t\t\t\t\t\t\t\turl: `${event.target.result}`\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\treader.readAsDataURL(file);\r\n\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\tSUPPORTED_FILE_TYPE.includes(file['type']) ||\r\n\t\t\t\t\t\t\tSUPPORTED_FILE_EXTENSIONS.includes(file.name.split('.').at(-1))\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tuploadDoc(file);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoast.error(\r\n\t\t\t\t\t\t\t\t$i18n.t(\r\n\t\t\t\t\t\t\t\t\t`Unknown File Type '{{file_type}}', but accepting and treating as plain text`,\r\n\t\t\t\t\t\t\t\t\t{ file_type: file['type'] }\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tuploadDoc(file);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoast.error($i18n.t(`File not found.`));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tdragged = false;\r\n\t\t};\r\n\r\n\t\twindow.addEventListener('keydown', handleKeyDown);\r\n\r\n\t\tdropZone?.addEventListener('dragover', onDragOver);\r\n\t\tdropZone?.addEventListener('drop', onDrop);\r\n\t\tdropZone?.addEventListener('dragleave', onDragLeave);\r\n\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener('keydown', handleKeyDown);\r\n\r\n\t\t\tdropZone?.removeEventListener('dragover', onDragOver);\r\n\t\t\tdropZone?.removeEventListener('drop', onDrop);\r\n\t\t\tdropZone?.removeEventListener('dragleave', onDragLeave);\r\n\t\t};\r\n\t});\r\n</script>\r\n\r\n{#if dragged}\r\n\t<div\r\n\t\tclass=\"fixed {$showSidebar\r\n\t\t\t? 'left-0 md:left-[260px] md:w-[calc(100%-260px)]'\r\n\t\t\t: 'left-0'}  w-full h-full flex z-50 touch-none pointer-events-none\"\r\n\t\tid=\"dropzone\"\r\n\t\trole=\"region\"\r\n\t\taria-label=\"Drag and Drop Container\"\r\n\t>\r\n\t\t<div class=\"absolute w-full h-full backdrop-blur bg-gray-800/40 flex justify-center\">\r\n\t\t\t<div class=\"m-auto pt-64 flex flex-col justify-center\">\r\n\t\t\t\t<div class=\"max-w-md\">\r\n\t\t\t\t\t<AddFilesPlaceholder />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n{/if}\r\n\r\n<div class=\"w-full\">\r\n\t<div class=\" -mb-0.5 mx-auto inset-x-0 bg-transparent flex justify-center\">\r\n\t\t<div class=\"flex flex-col max-w-6xl px-2.5 md:px-6 w-full\">\r\n\t\t\t<div class=\"relative\">\r\n\t\t\t\t{#if autoScroll === false && messages.length > 0}\r\n\t\t\t\t\t<div class=\" absolute -top-12 left-0 right-0 flex justify-center z-30\">\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\" bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full\"\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tautoScroll = true;\r\n\t\t\t\t\t\t\t\tscrollToBottom();\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\r\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\td=\"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z\"\r\n\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t{/if}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"w-full relative\">\r\n\t\t\t\t{#if prompt.charAt(0) === '/'}\r\n\t\t\t\t\t<Prompts bind:this={promptsElement} bind:prompt />\r\n\t\t\t\t{:else if prompt.charAt(0) === '#'}\r\n\t\t\t\t\t<Documents\r\n\t\t\t\t\t\tbind:this={documentsElement}\r\n\t\t\t\t\t\tbind:prompt\r\n\t\t\t\t\t\ton:youtube={(e) => {\r\n\t\t\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\t\t\tuploadYoutubeTranscription(e.detail);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\ton:url={(e) => {\r\n\t\t\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\t\t\tuploadWeb(e.detail);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\ton:select={(e) => {\r\n\t\t\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\t\t\tfiles = [\r\n\t\t\t\t\t\t\t\t...files,\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\ttype: e?.detail?.type ?? 'doc',\r\n\t\t\t\t\t\t\t\t\t...e.detail,\r\n\t\t\t\t\t\t\t\t\tupload_status: true\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t{/if}\r\n\r\n\t\t\t\t<Models\r\n\t\t\t\t\tbind:this={modelsElement}\r\n\t\t\t\t\tbind:prompt\r\n\t\t\t\t\tbind:user\r\n\t\t\t\t\tbind:chatInputPlaceholder\r\n\t\t\t\t\t{messages}\r\n\t\t\t\t\ton:select={(e) => {\r\n\t\t\t\t\t\tatSelectedModel = e.detail;\r\n\t\t\t\t\t\tchatTextAreaElement?.focus();\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\r\n\t\t\t\t{#if atSelectedModel !== undefined}\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclass=\"px-3 py-2.5 text-left w-full flex justify-between items-center absolute bottom-0 left-0 right-0 bg-gradient-to-t from-50% from-white dark:from-gray-900\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div class=\"flex items-center gap-2 text-sm dark:text-gray-500\">\r\n\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\tcrossorigin=\"anonymous\"\r\n\t\t\t\t\t\t\t\talt=\"model profile\"\r\n\t\t\t\t\t\t\t\tclass=\"size-5 max-w-[28px] object-cover rounded-full\"\r\n\t\t\t\t\t\t\t\tsrc={$models.find((model) => model.id === atSelectedModel.id)?.info?.meta\r\n\t\t\t\t\t\t\t\t\t?.profile_image_url ??\r\n\t\t\t\t\t\t\t\t\t($i18n.language === 'dg-DG'\r\n\t\t\t\t\t\t\t\t\t\t? `/doge.png`\r\n\t\t\t\t\t\t\t\t\t\t: `${WEBUI_BASE_URL}/static/favicon.png`)}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\tTalking to <span class=\" font-medium\">{atSelectedModel.name}</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tclass=\"flex items-center\"\r\n\t\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<XMark />\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t{/if}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<div class=\"bg-white dark:bg-gray-900\">\r\n\t\t<div class=\"max-w-6xl px-2.5 md:px-6 mx-auto inset-x-0\">\r\n\t\t\t<div class=\" pb-2\">\r\n\t\t\t\t<input\r\n\t\t\t\t\tbind:this={filesInputElement}\r\n\t\t\t\t\tbind:files={inputFiles}\r\n\t\t\t\t\ttype=\"file\"\r\n\t\t\t\t\thidden\r\n\t\t\t\t\tmultiple\r\n\t\t\t\t\ton:change={async () => {\r\n\t\t\t\t\t\tif (inputFiles && inputFiles.length > 0) {\r\n\t\t\t\t\t\t\tconst _inputFiles = Array.from(inputFiles);\r\n\t\t\t\t\t\t\t_inputFiles.forEach((file) => {\r\n\t\t\t\t\t\t\t\tif (['image/gif', 'image/webp', 'image/jpeg', 'image/png'].includes(file['type'])) {\r\n\t\t\t\t\t\t\t\t\tif (visionCapableModels.length === 0) {\r\n\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Selected model(s) do not support image inputs'));\r\n\t\t\t\t\t\t\t\t\t\tinputFiles = null;\r\n\t\t\t\t\t\t\t\t\t\tfilesInputElement.value = '';\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tlet reader = new FileReader();\r\n\t\t\t\t\t\t\t\t\treader.onload = (event) => {\r\n\t\t\t\t\t\t\t\t\t\tfiles = [\r\n\t\t\t\t\t\t\t\t\t\t\t...files,\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'image',\r\n\t\t\t\t\t\t\t\t\t\t\t\turl: `${event.target.result}`\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\t\t\t\tinputFiles = null;\r\n\t\t\t\t\t\t\t\t\t\tfilesInputElement.value = '';\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\treader.readAsDataURL(file);\r\n\t\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\t\tSUPPORTED_FILE_TYPE.includes(file['type']) ||\r\n\t\t\t\t\t\t\t\t\tSUPPORTED_FILE_EXTENSIONS.includes(file.name.split('.').at(-1))\r\n\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\tuploadDoc(file);\r\n\t\t\t\t\t\t\t\t\tfilesInputElement.value = '';\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\ttoast.error(\r\n\t\t\t\t\t\t\t\t\t\t$i18n.t(\r\n\t\t\t\t\t\t\t\t\t\t\t`Unknown File Type '{{file_type}}', but accepting and treating as plain text`,\r\n\t\t\t\t\t\t\t\t\t\t\t{ file_type: file['type'] }\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\tuploadDoc(file);\r\n\t\t\t\t\t\t\t\t\tfilesInputElement.value = '';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoast.error($i18n.t(`File not found.`));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t\t<form\r\n\t\t\t\t\tdir={$settings?.chatDirection ?? 'LTR'}\r\n\t\t\t\t\tclass=\" flex flex-col relative w-full rounded-3xl px-1.5 bg-gray-50 dark:bg-gray-850 dark:text-gray-100\"\r\n\t\t\t\t\ton:submit|preventDefault={() => {\r\n\t\t\t\t\t\t// check if selectedModels support image input\r\n\t\t\t\t\t\tsubmitPrompt(prompt, user);\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t{#if files.length > 0}\r\n\t\t\t\t\t\t<div class=\"mx-2 mt-2 mb-1 flex flex-wrap gap-2\">\r\n\t\t\t\t\t\t\t{#each files as file, fileIdx}\r\n\t\t\t\t\t\t\t\t<div class=\" relative group\">\r\n\t\t\t\t\t\t\t\t\t{#if file.type === 'image'}\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"relative\">\r\n\t\t\t\t\t\t\t\t\t\t\t<img src={file.url} alt=\"input\" class=\" h-16 w-16 rounded-xl object-cover\" />\r\n\t\t\t\t\t\t\t\t\t\t\t{#if atSelectedModel ? visionCapableModels.length === 0 : selectedModels.length !== visionCapableModels.length}\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\" absolute top-1 left-1\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={$i18n.t('{{ models }}', {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodels: [...(atSelectedModel ? [atSelectedModel] : selectedModels)]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.filter((id) => !visionCapableModels.includes(id))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.join(', ')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-4 fill-yellow-300\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{:else if file.type === 'doc'}\r\n\t\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-16 w-[15rem] flex items-center space-x-3 px-2.5 dark:bg-gray-600 rounded-xl border border-gray-200 dark:border-none\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"p-2.5 bg-red-400 text-white rounded-lg\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{#if file.upload_status}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-6 h-6\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5H5.625ZM7.5 15a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 7.5 15Zm.75 2.25a.75.75 0 0 0 0 1.5H12a.75.75 0 0 0 0-1.5H8.25Z\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{:else}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" w-6 h-6 translate-y-[0.5px]\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t><style>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_qM83 {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_oXPr {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_ZTLf {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t@keyframes spinner_8HQG {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0%,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t57.14% {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t28.57% {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t100% {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"2.5\" /><circle\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcx=\"12\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcy=\"12\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tr=\"2.5\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/><circle\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_ZTLf\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcx=\"20\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcy=\"12\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tr=\"2.5\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/></svg\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex flex-col justify-center -space-y-0.5\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" dark:text-gray-100 text-sm font-medium line-clamp-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{file.name}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" text-gray-500 text-sm\">{$i18n.t('Document')}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{:else if file.type === 'collection'}\r\n\t\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-16 w-[15rem] flex items-center space-x-3 px-2.5 dark:bg-gray-600 rounded-xl border border-gray-200 dark:border-none\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"p-2.5 bg-red-400 text-white rounded-lg\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-6 h-6\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M7.5 3.375c0-1.036.84-1.875 1.875-1.875h.375a3.75 3.75 0 0 1 3.75 3.75v1.875C13.5 8.161 14.34 9 15.375 9h1.875A3.75 3.75 0 0 1 21 12.75v3.375C21 17.16 20.16 18 19.125 18h-9.75A1.875 1.875 0 0 1 7.5 16.125V3.375Z\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M15 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 17.25 7.5h-1.875A.375.375 0 0 1 15 7.125V5.25ZM4.875 6H6v10.125A3.375 3.375 0 0 0 9.375 19.5H16.5v1.125c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V7.875C3 6.839 3.84 6 4.875 6Z\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex flex-col justify-center -space-y-0.5\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" dark:text-gray-100 text-sm font-medium line-clamp-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{file?.title ?? `#${file.name}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" text-gray-500 text-sm\">{$i18n.t('Collection')}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{/if}\r\n\r\n\t\t\t\t\t\t\t\t\t<div class=\" absolute -top-1 -right-1\">\r\n\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\tclass=\" bg-gray-400 text-white border border-white rounded-full group-hover:visible invisible transition\"\r\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tfiles.splice(fileIdx, 1);\r\n\t\t\t\t\t\t\t\t\t\t\t\tfiles = files;\r\n\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t{/each}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t{/if}\r\n\r\n\t\t\t\t\t<div class=\" flex\">\r\n\t\t\t\t\t\t<div class=\" ml-1 self-end mb-2 flex space-x-1\">\r\n\t\t\t\t\t\t\t<InputMenu\r\n\t\t\t\t\t\t\t\tbind:webSearchEnabled\r\n\t\t\t\t\t\t\t\tuploadFilesHandler={() => {\r\n\t\t\t\t\t\t\t\t\tfilesInputElement.click();\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\tonClose={async () => {\r\n\t\t\t\t\t\t\t\t\tawait tick();\r\n\t\t\t\t\t\t\t\t\tchatTextAreaElement?.focus();\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\tclass=\"bg-gray-50 hover:bg-gray-100 text-gray-800 dark:bg-gray-850 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5 outline-none focus:outline-none\"\r\n\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\r\n\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\td=\"M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z\"\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t</InputMenu>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<textarea\r\n\t\t\t\t\t\t\tid=\"chat-textarea\"\r\n\t\t\t\t\t\t\tbind:this={chatTextAreaElement}\r\n\t\t\t\t\t\t\tclass=\"scrollbar-hidden bg-gray-50 dark:bg-gray-850 dark:text-gray-100 outline-none w-full py-3 px-3 rounded-xl resize-none h-[48px]\"\r\n\t\t\t\t\t\t\tplaceholder={chatInputPlaceholder !== ''\r\n\t\t\t\t\t\t\t\t? chatInputPlaceholder\r\n\t\t\t\t\t\t\t\t: isRecording\r\n\t\t\t\t\t\t\t\t? $i18n.t('Listening...')\r\n\t\t\t\t\t\t\t\t: $i18n.t('Send a Message')}\r\n\t\t\t\t\t\t\tbind:value={prompt}\r\n\t\t\t\t\t\t\ton:keypress={(e) => {\r\n\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\t!$mobile ||\r\n\t\t\t\t\t\t\t\t\t!(\r\n\t\t\t\t\t\t\t\t\t\t'ontouchstart' in window ||\r\n\t\t\t\t\t\t\t\t\t\tnavigator.maxTouchPoints > 0 ||\r\n\t\t\t\t\t\t\t\t\t\tnavigator.msMaxTouchPoints > 0\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\t// Prevent Enter key from creating a new line\r\n\t\t\t\t\t\t\t\t\tif (e.key === 'Enter' && !e.shiftKey) {\r\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// Submit the prompt when Enter key is pressed\r\n\t\t\t\t\t\t\t\t\tif (prompt !== '' && e.key === 'Enter' && !e.shiftKey) {\r\n\t\t\t\t\t\t\t\t\t\tsubmitPrompt(prompt, user);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\ton:keydown={async (e) => {\r\n\t\t\t\t\t\t\t\tconst isCtrlPressed = e.ctrlKey || e.metaKey; // metaKey is for Cmd key on Mac\r\n\r\n\t\t\t\t\t\t\t\t// Check if Ctrl + R is pressed\r\n\t\t\t\t\t\t\t\tif (prompt === '' && isCtrlPressed && e.key.toLowerCase() === 'r') {\r\n\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\tconsole.log('regenerate');\r\n\r\n\t\t\t\t\t\t\t\t\tconst regenerateButton = [\r\n\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('regenerate-response-button')\r\n\t\t\t\t\t\t\t\t\t]?.at(-1);\r\n\r\n\t\t\t\t\t\t\t\t\tregenerateButton?.click();\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (prompt === '' && e.key == 'ArrowUp') {\r\n\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t\t\tconst userMessageElement = [\r\n\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('user-message')\r\n\t\t\t\t\t\t\t\t\t]?.at(-1);\r\n\r\n\t\t\t\t\t\t\t\t\tconst editButton = [\r\n\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('edit-user-message-button')\r\n\t\t\t\t\t\t\t\t\t]?.at(-1);\r\n\r\n\t\t\t\t\t\t\t\t\tconsole.log(userMessageElement);\r\n\r\n\t\t\t\t\t\t\t\t\tuserMessageElement.scrollIntoView({ block: 'center' });\r\n\t\t\t\t\t\t\t\t\teditButton?.click();\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (['/', '#', '@'].includes(prompt.charAt(0)) && e.key === 'ArrowUp') {\r\n\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t\t\t(promptsElement || documentsElement || modelsElement).selectUp();\r\n\r\n\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\r\n\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\r\n\t\t\t\t\t\t\t\t\t]?.at(-1);\r\n\t\t\t\t\t\t\t\t\tcommandOptionButton.scrollIntoView({ block: 'center' });\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (['/', '#', '@'].includes(prompt.charAt(0)) && e.key === 'ArrowDown') {\r\n\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t\t\t(promptsElement || documentsElement || modelsElement).selectDown();\r\n\r\n\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\r\n\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\r\n\t\t\t\t\t\t\t\t\t]?.at(-1);\r\n\t\t\t\t\t\t\t\t\tcommandOptionButton.scrollIntoView({ block: 'center' });\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (['/', '#', '@'].includes(prompt.charAt(0)) && e.key === 'Enter') {\r\n\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\r\n\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\r\n\t\t\t\t\t\t\t\t\t]?.at(-1);\r\n\r\n\t\t\t\t\t\t\t\t\tif (e.shiftKey) {\r\n\t\t\t\t\t\t\t\t\t\tprompt = `${prompt}\\n`;\r\n\t\t\t\t\t\t\t\t\t} else if (commandOptionButton) {\r\n\t\t\t\t\t\t\t\t\t\tcommandOptionButton?.click();\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('send-message-button')?.click();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (['/', '#', '@'].includes(prompt.charAt(0)) && e.key === 'Tab') {\r\n\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\r\n\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\r\n\t\t\t\t\t\t\t\t\t]?.at(-1);\r\n\r\n\t\t\t\t\t\t\t\t\tcommandOptionButton?.click();\r\n\t\t\t\t\t\t\t\t} else if (e.key === 'Tab') {\r\n\t\t\t\t\t\t\t\t\tconst words = findWordIndices(prompt);\r\n\r\n\t\t\t\t\t\t\t\t\tif (words.length > 0) {\r\n\t\t\t\t\t\t\t\t\t\tconst word = words.at(0);\r\n\t\t\t\t\t\t\t\t\t\tconst fullPrompt = prompt;\r\n\r\n\t\t\t\t\t\t\t\t\t\tprompt = prompt.substring(0, word?.endIndex + 1);\r\n\t\t\t\t\t\t\t\t\t\tawait tick();\r\n\r\n\t\t\t\t\t\t\t\t\t\te.target.scrollTop = e.target.scrollHeight;\r\n\t\t\t\t\t\t\t\t\t\tprompt = fullPrompt;\r\n\t\t\t\t\t\t\t\t\t\tawait tick();\r\n\r\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t\te.target.setSelectionRange(word?.startIndex, word.endIndex + 1);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\te.target.style.height = '';\r\n\t\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\r\n\t\t\t\t\t\t\t\t\tconsole.log('Escape');\r\n\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\trows=\"1\"\r\n\t\t\t\t\t\t\ton:input={(e) => {\r\n\t\t\t\t\t\t\t\te.target.style.height = '';\r\n\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\r\n\t\t\t\t\t\t\t\tuser = null;\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\ton:focus={(e) => {\r\n\t\t\t\t\t\t\t\te.target.style.height = '';\r\n\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\ton:paste={(e) => {\r\n\t\t\t\t\t\t\t\tconst clipboardData = e.clipboardData || window.clipboardData;\r\n\r\n\t\t\t\t\t\t\t\tif (clipboardData && clipboardData.items) {\r\n\t\t\t\t\t\t\t\t\tfor (const item of clipboardData.items) {\r\n\t\t\t\t\t\t\t\t\t\tif (item.type.indexOf('image') !== -1) {\r\n\t\t\t\t\t\t\t\t\t\t\tconst blob = item.getAsFile();\r\n\t\t\t\t\t\t\t\t\t\t\tconst reader = new FileReader();\r\n\r\n\t\t\t\t\t\t\t\t\t\t\treader.onload = function (e) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tfiles = [\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t...files,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'image',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: `${e.target.result}`\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t\t\t\t\treader.readAsDataURL(blob);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t\t<div class=\"self-end mb-2 flex space-x-1 mr-1\">\r\n\t\t\t\t\t\t\t{#if messages.length == 0 || messages.at(-1).done == true}\r\n\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Record voice')}>\r\n\t\t\t\t\t\t\t\t\t{#if speechRecognitionEnabled}\r\n\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\tid=\"voice-input-button\"\r\n\t\t\t\t\t\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-1.5 mr-0.5 self-center\"\r\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tspeechRecognitionHandler();\r\n\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t{#if isRecording}\r\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" w-5 h-5 translate-y-[0.5px]\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t><style>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_qM83 {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_oXPr {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_ZTLf {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t@keyframes spinner_8HQG {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0%,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t57.14% {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t28.57% {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t100% {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"2.5\" /><circle\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcx=\"12\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcy=\"12\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tr=\"2.5\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/><circle\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_ZTLf\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcx=\"20\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcy=\"12\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tr=\"2.5\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/></svg\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t{:else}\r\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-5 h-5 translate-y-[0.5px]\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path d=\"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t\t\t\t</Tooltip>\r\n\r\n\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Send message')}>\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tid=\"send-message-button\"\r\n\t\t\t\t\t\t\t\t\t\tclass=\"{prompt !== ''\r\n\t\t\t\t\t\t\t\t\t\t\t? 'bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 '\r\n\t\t\t\t\t\t\t\t\t\t\t: 'text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled'} transition rounded-full p-1.5 self-center\"\r\n\t\t\t\t\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t\t\t\t\t\tdisabled={prompt === ''}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\r\n\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\t\t\td=\"M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t\t{:else}\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\tclass=\"bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5\"\r\n\t\t\t\t\t\t\t\t\ton:click={stopResponse}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\t\td=\"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z\"\r\n\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t{/if}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</form>\r\n\r\n\t\t\t\t<div class=\"mt-1.5 text-xs text-gray-500 text-center\">\r\n\t\t\t\t\t{$i18n.t('LLMs can make mistakes. Verify important information.')}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n\r\n<style>\r\n\t.scrollbar-hidden:active::-webkit-scrollbar-thumb,\r\n\t.scrollbar-hidden:focus::-webkit-scrollbar-thumb,\r\n\t.scrollbar-hidden:hover::-webkit-scrollbar-thumb {\r\n\t\tvisibility: visible;\r\n\t}\r\n\t.scrollbar-hidden::-webkit-scrollbar-thumb {\r\n\t\tvisibility: hidden;\r\n\t}\r\n</style>\r\n","<script lang=\"ts\">\r\n\timport { models, showSettings, settings, user, mobile } from '$lib/stores';\r\n\timport { onMount, tick, getContext } from 'svelte';\r\n\timport { toast } from 'svelte-sonner';\r\n\timport Selector from './ModelSelector/Selector.svelte';\r\n\timport Tooltip from '../common/Tooltip.svelte';\r\n\r\n\timport { setDefaultModels } from '$lib/apis/configs';\r\n\timport { updateUserSettings } from '$lib/apis/users';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let selectedModels = [''];\r\n\texport let disabled = false;\r\n\r\n\texport let showSetDefault = true;\r\n\r\n\tconst saveDefaultModel = async () => {\r\n\t\tconst hasEmptyModel = selectedModels.filter((it) => it === '');\r\n\t\tif (hasEmptyModel.length) {\r\n\t\t\ttoast.error($i18n.t('Choose a model before saving...'));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsettings.set({ ...$settings, models: selectedModels });\r\n\t\tawait updateUserSettings(localStorage.token, { ui: $settings });\r\n\r\n\t\ttoast.success($i18n.t('Default model updated'));\r\n\t};\r\n\r\n\t$: if (selectedModels.length > 0 && $models.length > 0) {\r\n\t\tselectedModels = selectedModels.map((model) =>\r\n\t\t\t$models.map((m) => m.id).includes(model) ? model : ''\r\n\t\t);\r\n\t}\r\n</script>\r\n\r\n<div class=\"flex flex-col w-full items-center md:items-start\">\r\n\t{#each selectedModels as selectedModel, selectedModelIdx}\r\n\t\t<div class=\"flex w-full max-w-fit\">\r\n\t\t\t<div class=\"overflow-hidden w-full\">\r\n\t\t\t\t<div class=\"mr-1 max-w-full\">\r\n\t\t\t\t\t<Selector\r\n\t\t\t\t\t\tplaceholder={$i18n.t('Select a model')}\r\n\t\t\t\t\t\titems={$models.map((model) => ({\r\n\t\t\t\t\t\t\tvalue: model.id,\r\n\t\t\t\t\t\t\tlabel: model.name,\r\n\t\t\t\t\t\t\tmodel: model\r\n\t\t\t\t\t\t}))}\r\n\t\t\t\t\t\tbind:value={selectedModel}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t{#if selectedModelIdx === 0}\r\n\t\t\t\t<div class=\"  self-center mr-2 disabled:text-gray-600 disabled:hover:text-gray-600\">\r\n\t\t\t\t\t<Tooltip content={$i18n.t('Add Model')}>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\" \"\r\n\t\t\t\t\t\t\t{disabled}\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tselectedModels = [...selectedModels, ''];\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\r\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\t\t\tclass=\"size-3.5\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 6v12m6-6H6\" />\r\n\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</Tooltip>\r\n\t\t\t\t</div>\r\n\t\t\t{:else}\r\n\t\t\t\t<div class=\"  self-center disabled:text-gray-600 disabled:hover:text-gray-600 mr-2\">\r\n\t\t\t\t\t<Tooltip content={$i18n.t('Remove Model')}>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t{disabled}\r\n\t\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\t\tselectedModels.splice(selectedModelIdx, 1);\r\n\t\t\t\t\t\t\t\tselectedModels = selectedModels;\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\r\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\t\t\tclass=\"size-3.5\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M19.5 12h-15\" />\r\n\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</Tooltip>\r\n\t\t\t\t</div>\r\n\t\t\t{/if}\r\n\t\t</div>\r\n\t{/each}\r\n</div>\r\n\r\n{#if showSetDefault && !$mobile}\r\n\t<div class=\"text-left mt-0.5 ml-1 text-[0.7rem] text-gray-500\">\r\n\t\t<button on:click={saveDefaultModel}> {$i18n.t('Set as default')}</button>\r\n\t</div>\r\n{/if}\r\n","<script lang=\"ts\">\r\n\timport { DropdownMenu } from 'bits-ui';\r\n\timport { getContext } from 'svelte';\r\n\r\n\timport fileSaver from 'file-saver';\r\n\tconst { saveAs } = fileSaver;\r\n\r\n\timport { showSettings } from '$lib/stores';\r\n\timport { flyAndScale } from '$lib/utils/transitions';\r\n\r\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\r\n\timport Tags from '$lib/components/chat/Tags.svelte';\r\n\r\n\timport { downloadChatAsPDF } from '$lib/apis/utils';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let shareEnabled: boolean = false;\r\n\texport let shareHandler: Function;\r\n\texport let downloadHandler: Function;\r\n\r\n\t// export let tagHandler: Function;\r\n\r\n\texport let chat;\r\n\texport let onClose: Function = () => {};\r\n\r\n\tconst downloadTxt = async () => {\r\n\t\tconst _chat = chat.chat;\r\n\t\tconsole.log('download', chat);\r\n\r\n\t\tconst chatText = _chat.messages.reduce((a, message, i, arr) => {\r\n\t\t\treturn `${a}### ${message.role.toUpperCase()}\\n${message.content}\\n\\n`;\r\n\t\t}, '');\r\n\r\n\t\tlet blob = new Blob([chatText], {\r\n\t\t\ttype: 'text/plain'\r\n\t\t});\r\n\r\n\t\tsaveAs(blob, `chat-${_chat.title}.txt`);\r\n\t};\r\n\r\n\tconst downloadPdf = async () => {\r\n\t\tconst _chat = chat.chat;\r\n\t\tconsole.log('download', chat);\r\n\r\n\t\tconst blob = await downloadChatAsPDF(_chat);\r\n\r\n\t\t// Create a URL for the blob\r\n\t\tconst url = window.URL.createObjectURL(blob);\r\n\r\n\t\t// Create a link element to trigger the download\r\n\t\tconst a = document.createElement('a');\r\n\t\ta.href = url;\r\n\t\ta.download = `chat-${_chat.title}.pdf`;\r\n\r\n\t\t// Append the link to the body and click it programmatically\r\n\t\tdocument.body.appendChild(a);\r\n\t\ta.click();\r\n\r\n\t\t// Remove the link from the body\r\n\t\tdocument.body.removeChild(a);\r\n\r\n\t\t// Revoke the URL to release memory\r\n\t\twindow.URL.revokeObjectURL(url);\r\n\t};\r\n\r\n\tconst downloadJSONExport = async () => {\r\n\t\tlet blob = new Blob([JSON.stringify([chat])], {\r\n\t\t\ttype: 'application/json'\r\n\t\t});\r\n\t\tsaveAs(blob, `chat-export-${Date.now()}.json`);\r\n\t};\r\n</script>\r\n\r\n<Dropdown\r\n\ton:change={(e) => {\r\n\t\tif (e.detail === false) {\r\n\t\t\tonClose();\r\n\t\t}\r\n\t}}\r\n>\r\n\t<slot />\r\n\r\n\t<div slot=\"content\">\r\n\t\t<DropdownMenu.Content\r\n\t\t\tclass=\"w-full max-w-[200px] rounded-xl px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\r\n\t\t\tsideOffset={8}\r\n\t\t\tside=\"bottom\"\r\n\t\t\talign=\"end\"\r\n\t\t\ttransition={flyAndScale}\r\n\t\t>\r\n\t\t\t<!-- <DropdownMenu.Item\r\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\ton:click={async () => {\r\n\t\t\t\t\tawait showSettings.set(!$showSettings);\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<svg\r\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\tstroke-width=\"1.5\"\r\n\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\tclass=\"size-4\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<path\r\n\t\t\t\t\t\tstroke-linecap=\"round\"\r\n\t\t\t\t\t\tstroke-linejoin=\"round\"\r\n\t\t\t\t\t\td=\"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<path\r\n\t\t\t\t\t\tstroke-linecap=\"round\"\r\n\t\t\t\t\t\tstroke-linejoin=\"round\"\r\n\t\t\t\t\t\td=\"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</svg>\r\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Settings')}</div>\r\n\t\t\t</DropdownMenu.Item> -->\r\n\r\n\t\t\t<DropdownMenu.Item\r\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\tid=\"chat-share-button\"\r\n\t\t\t\ton:click={() => {\r\n\t\t\t\t\tshareHandler();\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<svg\r\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\tclass=\"size-4\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<path\r\n\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\td=\"M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z\"\r\n\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</svg>\r\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Share')}</div>\r\n\t\t\t</DropdownMenu.Item>\r\n\t\t\t<!-- <DropdownMenu.Item\r\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer\"\r\n\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\tdownloadHandler();\r\n\t\t\t\t\t}}\r\n\t\t\t\t/> -->\r\n\t\t\t<DropdownMenu.Sub>\r\n\t\t\t\t<DropdownMenu.SubTrigger\r\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<svg\r\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\tstroke-width=\"1.5\"\r\n\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\tclass=\"size-4\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\r\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\r\n\t\t\t\t\t\t\td=\"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</svg>\r\n\r\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Download')}</div>\r\n\t\t\t\t</DropdownMenu.SubTrigger>\r\n\t\t\t\t<DropdownMenu.SubContent\r\n\t\t\t\t\tclass=\"w-full rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\r\n\t\t\t\t\ttransition={flyAndScale}\r\n\t\t\t\t\tsideOffset={8}\r\n\t\t\t\t>\r\n\t\t\t\t\t<DropdownMenu.Item\r\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\tdownloadJSONExport();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Export chat (.json)')}</div>\r\n\t\t\t\t\t</DropdownMenu.Item>\r\n\t\t\t\t\t<DropdownMenu.Item\r\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\tdownloadTxt();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Plain text (.txt)')}</div>\r\n\t\t\t\t\t</DropdownMenu.Item>\r\n\r\n\t\t\t\t\t<DropdownMenu.Item\r\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\r\n\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\tdownloadPdf();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('PDF document (.pdf)')}</div>\r\n\t\t\t\t\t</DropdownMenu.Item>\r\n\t\t\t\t</DropdownMenu.SubContent>\r\n\t\t\t</DropdownMenu.Sub>\r\n\r\n\t\t\t<hr class=\"border-gray-100 dark:border-gray-800 mt-2.5 mb-1.5\" />\r\n\r\n\t\t\t<div class=\"flex p-1\">\r\n\t\t\t\t<Tags chatId={chat.id} />\r\n\t\t\t</div>\r\n\t\t</DropdownMenu.Content>\r\n\t</div>\r\n</Dropdown>\r\n","<script lang=\"ts\">\r\n\timport { getContext } from 'svelte';\r\n\timport { toast } from 'svelte-sonner';\r\n\r\n\timport {\r\n\t\tWEBUI_NAME,\r\n\t\tchatId,\r\n\t\tmobile,\r\n\t\tsettings,\r\n\t\tshowArchivedChats,\r\n\t\tshowSettings,\r\n\t\tshowSidebar,\r\n\t\tuser\r\n\t} from '$lib/stores';\r\n\r\n\timport { slide } from 'svelte/transition';\r\n\timport ShareChatModal from '../chat/ShareChatModal.svelte';\r\n\timport ModelSelector from '../chat/ModelSelector.svelte';\r\n\timport Tooltip from '../common/Tooltip.svelte';\r\n\timport Menu from './Navbar/Menu.svelte';\r\n\timport { page } from '$app/stores';\r\n\timport UserMenu from './Sidebar/UserMenu.svelte';\r\n\timport MenuLines from '../icons/MenuLines.svelte';\r\n\r\n\tconst i18n = getContext('i18n');\r\n\r\n\texport let initNewChat: Function;\r\n\texport let title: string = $WEBUI_NAME;\r\n\texport let shareEnabled: boolean = false;\r\n\r\n\texport let chat;\r\n\texport let selectedModels;\r\n\r\n\texport let showModelSelector = true;\r\n\r\n\tlet showShareChatModal = false;\r\n\tlet showDownloadChatModal = false;\r\n</script>\r\n\r\n<ShareChatModal bind:show={showShareChatModal} chatId={$chatId} />\r\n<nav id=\"nav\" class=\" sticky py-2.5 top-0 flex flex-row justify-center z-30\">\r\n\t<div class=\" flex max-w-full w-full mx-auto px-5 pt-0.5 md:px-[1rem]\">\r\n\t\t<div class=\"flex items-center w-full max-w-full\">\r\n\t\t\t<div\r\n\t\t\t\tclass=\"{$showSidebar\r\n\t\t\t\t\t? 'md:hidden'\r\n\t\t\t\t\t: ''} mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400\"\r\n\t\t\t>\r\n\t\t\t\t<button\r\n\t\t\t\t\tid=\"sidebar-toggle-button\"\r\n\t\t\t\t\tclass=\"cursor-pointer px-2 py-2 flex rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition\"\r\n\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\tshowSidebar.set(!$showSidebar);\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div class=\" m-auto self-center\">\r\n\t\t\t\t\t\t<MenuLines />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"flex-1 overflow-hidden max-w-full\">\r\n\t\t\t\t{#if showModelSelector}\r\n\t\t\t\t\t<ModelSelector bind:selectedModels showSetDefault={!shareEnabled} />\r\n\t\t\t\t{/if}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"self-start flex flex-none items-center text-gray-600 dark:text-gray-400\">\r\n\t\t\t\t<!-- <div class=\"md:hidden flex self-center w-[1px] h-5 mx-2 bg-gray-300 dark:bg-stone-700\" /> -->\r\n\r\n\t\t\t\t{#if shareEnabled && chat && chat.id}\r\n\t\t\t\t\t<Menu\r\n\t\t\t\t\t\t{chat}\r\n\t\t\t\t\t\t{shareEnabled}\r\n\t\t\t\t\t\tshareHandler={() => {\r\n\t\t\t\t\t\t\tshowShareChatModal = !showShareChatModal;\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tdownloadHandler={() => {\r\n\t\t\t\t\t\t\tshowDownloadChatModal = !showDownloadChatModal;\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\"hidden md:flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition\"\r\n\t\t\t\t\t\t\tid=\"chat-context-menu-button\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\r\n\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\t\tstroke-width=\"1.5\"\r\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\tclass=\"size-5\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\r\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\r\n\t\t\t\t\t\t\t\t\t\td=\"M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z\"\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</Menu>\r\n\t\t\t\t{/if}\r\n\t\t\t\t<Tooltip content={$i18n.t('New Chat')}>\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tid=\"new-chat-button\"\r\n\t\t\t\t\t\tclass=\" flex {$showSidebar\r\n\t\t\t\t\t\t\t? 'md:hidden'\r\n\t\t\t\t\t\t\t: ''} cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition\"\r\n\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\tinitNewChat();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div class=\" m-auto self-center\">\r\n\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\r\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\td=\"M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\td=\"M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</Tooltip>\r\n\r\n\t\t\t\t{#if $user !== undefined}\r\n\t\t\t\t\t<UserMenu\r\n\t\t\t\t\t\tclassName=\"max-w-[200px]\"\r\n\t\t\t\t\t\trole={$user.role}\r\n\t\t\t\t\t\ton:show={(e) => {\r\n\t\t\t\t\t\t\tif (e.detail === 'archived-chat') {\r\n\t\t\t\t\t\t\t\tshowArchivedChats.set(true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\"select-none flex rounded-xl p-1.5 w-full hover:bg-gray-100 dark:hover:bg-gray-850 transition\"\r\n\t\t\t\t\t\t\taria-label=\"User Menu\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div class=\" self-center\">\r\n\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\tsrc={$user.profile_image_url}\r\n\t\t\t\t\t\t\t\t\tclass=\"size-6 object-cover rounded-full\"\r\n\t\t\t\t\t\t\t\t\talt=\"User profile\"\r\n\t\t\t\t\t\t\t\t\tdraggable=\"false\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</UserMenu>\r\n\t\t\t\t{/if}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</nav>\r\n","function createParser(onParse) {\n  let isFirstChunk;\n  let buffer;\n  let startingPosition;\n  let startingFieldLength;\n  let eventId;\n  let eventName;\n  let data;\n  reset();\n  return {\n    feed,\n    reset\n  };\n  function reset() {\n    isFirstChunk = true;\n    buffer = \"\";\n    startingPosition = 0;\n    startingFieldLength = -1;\n    eventId = void 0;\n    eventName = void 0;\n    data = \"\";\n  }\n  function feed(chunk) {\n    buffer = buffer ? buffer + chunk : chunk;\n    if (isFirstChunk && hasBom(buffer)) {\n      buffer = buffer.slice(BOM.length);\n    }\n    isFirstChunk = false;\n    const length = buffer.length;\n    let position = 0;\n    let discardTrailingNewline = false;\n    while (position < length) {\n      if (discardTrailingNewline) {\n        if (buffer[position] === \"\\n\") {\n          ++position;\n        }\n        discardTrailingNewline = false;\n      }\n      let lineLength = -1;\n      let fieldLength = startingFieldLength;\n      let character;\n      for (let index = startingPosition; lineLength < 0 && index < length; ++index) {\n        character = buffer[index];\n        if (character === \":\" && fieldLength < 0) {\n          fieldLength = index - position;\n        } else if (character === \"\\r\") {\n          discardTrailingNewline = true;\n          lineLength = index - position;\n        } else if (character === \"\\n\") {\n          lineLength = index - position;\n        }\n      }\n      if (lineLength < 0) {\n        startingPosition = length - position;\n        startingFieldLength = fieldLength;\n        break;\n      } else {\n        startingPosition = 0;\n        startingFieldLength = -1;\n      }\n      parseEventStreamLine(buffer, position, fieldLength, lineLength);\n      position += lineLength + 1;\n    }\n    if (position === length) {\n      buffer = \"\";\n    } else if (position > 0) {\n      buffer = buffer.slice(position);\n    }\n  }\n  function parseEventStreamLine(lineBuffer, index, fieldLength, lineLength) {\n    if (lineLength === 0) {\n      if (data.length > 0) {\n        onParse({\n          type: \"event\",\n          id: eventId,\n          event: eventName || void 0,\n          data: data.slice(0, -1)\n          // remove trailing newline\n        });\n\n        data = \"\";\n        eventId = void 0;\n      }\n      eventName = void 0;\n      return;\n    }\n    const noValue = fieldLength < 0;\n    const field = lineBuffer.slice(index, index + (noValue ? lineLength : fieldLength));\n    let step = 0;\n    if (noValue) {\n      step = lineLength;\n    } else if (lineBuffer[index + fieldLength + 1] === \" \") {\n      step = fieldLength + 2;\n    } else {\n      step = fieldLength + 1;\n    }\n    const position = index + step;\n    const valueLength = lineLength - step;\n    const value = lineBuffer.slice(position, position + valueLength).toString();\n    if (field === \"data\") {\n      data += value ? \"\".concat(value, \"\\n\") : \"\\n\";\n    } else if (field === \"event\") {\n      eventName = value;\n    } else if (field === \"id\" && !value.includes(\"\\0\")) {\n      eventId = value;\n    } else if (field === \"retry\") {\n      const retry = parseInt(value, 10);\n      if (!Number.isNaN(retry)) {\n        onParse({\n          type: \"reconnect-interval\",\n          value: retry\n        });\n      }\n    }\n  }\n}\nconst BOM = [239, 187, 191];\nfunction hasBom(buffer) {\n  return BOM.every((charCode, index) => buffer.charCodeAt(index) === charCode);\n}\nexport { createParser };\n//# sourceMappingURL=index.js.map\n","import { createParser } from './index.js';\nclass EventSourceParserStream extends TransformStream {\n  constructor() {\n    let parser;\n    super({\n      start(controller) {\n        parser = createParser(event => {\n          if (event.type === \"event\") {\n            controller.enqueue(event);\n          }\n        });\n      },\n      transform(chunk) {\n        parser.feed(chunk);\n      }\n    });\n  }\n}\nexport { EventSourceParserStream };\n//# sourceMappingURL=stream.js.map\n","import { EventSourceParserStream } from 'eventsource-parser/stream';\r\nimport type { ParsedEvent } from 'eventsource-parser';\r\n\r\ntype TextStreamUpdate = {\r\n\tdone: boolean;\r\n\tvalue: string;\r\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\tcitations?: any;\r\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\terror?: any;\r\n\tusage?: ResponseUsage;\r\n};\r\n\r\ntype ResponseUsage = {\r\n\t/** Including images and tools if any */\r\n\tprompt_tokens: number;\r\n\t/** The tokens generated */\r\n\tcompletion_tokens: number;\r\n\t/** Sum of the above two fields */\r\n\ttotal_tokens: number;\r\n};\r\n\r\n// createOpenAITextStream takes a responseBody with a SSE response,\r\n// and returns an async generator that emits delta updates with large deltas chunked into random sized chunks\r\nexport async function createOpenAITextStream(\r\n\tresponseBody: ReadableStream<Uint8Array>,\r\n\tsplitLargeDeltas: boolean\r\n): Promise<AsyncGenerator<TextStreamUpdate>> {\r\n\tconst eventStream = responseBody\r\n\t\t.pipeThrough(new TextDecoderStream())\r\n\t\t.pipeThrough(new EventSourceParserStream())\r\n\t\t.getReader();\r\n\tlet iterator = openAIStreamToIterator(eventStream);\r\n\tif (splitLargeDeltas) {\r\n\t\titerator = streamLargeDeltasAsRandomChunks(iterator);\r\n\t}\r\n\treturn iterator;\r\n}\r\n\r\nasync function* openAIStreamToIterator(\r\n\treader: ReadableStreamDefaultReader<ParsedEvent>\r\n): AsyncGenerator<TextStreamUpdate> {\r\n\twhile (true) {\r\n\t\tconst { value, done } = await reader.read();\r\n\t\tif (done) {\r\n\t\t\tyield { done: true, value: '' };\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif (!value) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst data = value.data;\r\n\t\tif (data.startsWith('[DONE]')) {\r\n\t\t\tyield { done: true, value: '' };\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst parsedData = JSON.parse(data);\r\n\t\t\tconsole.log(parsedData);\r\n\r\n\t\t\tif (parsedData.error) {\r\n\t\t\t\tyield { done: true, value: '', error: parsedData.error };\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (parsedData.citations) {\r\n\t\t\t\tyield { done: false, value: '', citations: parsedData.citations };\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tyield {\r\n\t\t\t\tdone: false,\r\n\t\t\t\tvalue: parsedData.choices?.[0]?.delta?.content ?? '',\r\n\t\t\t\tusage: parsedData.usage\r\n\t\t\t};\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error('Error extracting delta from SSE event:', e);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// streamLargeDeltasAsRandomChunks will chunk large deltas (length > 5) into random sized chunks between 1-3 characters\r\n// This is to simulate a more fluid streaming, even though some providers may send large chunks of text at once\r\nasync function* streamLargeDeltasAsRandomChunks(\r\n\titerator: AsyncGenerator<TextStreamUpdate>\r\n): AsyncGenerator<TextStreamUpdate> {\r\n\tfor await (const textStreamUpdate of iterator) {\r\n\t\tif (textStreamUpdate.done) {\r\n\t\t\tyield textStreamUpdate;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (textStreamUpdate.citations) {\r\n\t\t\tyield textStreamUpdate;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tlet content = textStreamUpdate.value;\r\n\t\tif (content.length < 5) {\r\n\t\t\tyield { done: false, value: content };\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\twhile (content != '') {\r\n\t\t\tconst chunkSize = Math.min(Math.floor(Math.random() * 3) + 1, content.length);\r\n\t\t\tconst chunk = content.slice(0, chunkSize);\r\n\t\t\tyield { done: false, value: chunk };\r\n\t\t\t// Do not sleep if the tab is hidden\r\n\t\t\t// Timers are throttled to 1s in hidden tabs\r\n\t\t\tif (document?.visibilityState !== 'hidden') {\r\n\t\t\t\tawait sleep(5);\r\n\t\t\t}\r\n\t\t\tcontent = content.slice(chunkSize);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\r\n","<script lang=\"ts\">\r\n\timport type { Banner } from '$lib/types';\r\n\timport { onMount, createEventDispatcher } from 'svelte';\r\n\timport { fade } from 'svelte/transition';\r\n\r\n\tconst dispatch = createEventDispatcher();\r\n\r\n\texport let banner: Banner = {\r\n\t\tid: '',\r\n\t\ttype: 'info',\r\n\t\ttitle: '',\r\n\t\tcontent: '',\r\n\t\turl: '',\r\n\t\tdismissable: true,\r\n\t\ttimestamp: Math.floor(Date.now() / 1000)\r\n\t};\r\n\r\n\texport let dismissed = false;\r\n\r\n\tlet mounted = false;\r\n\r\n\tconst classNames: Record<string, string> = {\r\n\t\tinfo: 'bg-blue-500/20 text-blue-700 dark:text-blue-200 ',\r\n\t\tsuccess: 'bg-green-500/20 text-green-700 dark:text-green-200',\r\n\t\twarning: 'bg-yellow-500/20 text-yellow-700 dark:text-yellow-200',\r\n\t\terror: 'bg-red-500/20 text-red-700 dark:text-red-200'\r\n\t};\r\n\r\n\tconst dismiss = (id) => {\r\n\t\tdismissed = true;\r\n\t\tdispatch('dismiss', id);\r\n\t};\r\n\r\n\tonMount(() => {\r\n\t\tmounted = true;\r\n\t});\r\n</script>\r\n\r\n{#if !dismissed}\r\n\t{#if mounted}\r\n\t\t<div\r\n\t\t\tclass=\" top-0 left-0 right-0 p-2 mx-4 px-3 flex justify-center items-center relative rounded-xl border border-gray-50 dark:border-gray-850 text-gray-800 dark:text-gary-100 bg-white dark:bg-gray-900 backdrop-blur-xl z-30\"\r\n\t\t\ttransition:fade={{ delay: 100, duration: 300 }}\r\n\t\t>\r\n\t\t\t<div class=\" flex flex-col md:flex-row md:items-center flex-1 text-sm w-fit gap-1.5\">\r\n\t\t\t\t<div class=\"flex justify-between self-start\">\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclass=\" text-xs font-black {classNames[banner.type] ??\r\n\t\t\t\t\t\t\tclassNames['info']}  w-fit px-2 rounded uppercase line-clamp-1 mr-0.5\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{banner.type}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{#if banner.url}\r\n\t\t\t\t\t\t<div class=\"flex md:hidden group w-fit md:items-center\">\r\n\t\t\t\t\t\t\t<a\r\n\t\t\t\t\t\t\t\tclass=\"text-gray-700 dark:text-white text-xs font-bold underline\"\r\n\t\t\t\t\t\t\t\thref=\"/assets/files/whitepaper.pdf\"\r\n\t\t\t\t\t\t\t\ttarget=\"_blank\">Learn More</a\r\n\t\t\t\t\t\t\t>\r\n\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\" ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<!--  -->\r\n\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\r\n\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\r\n\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t{/if}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"flex-1 text-xs text-gray-700 dark:text-white\">\r\n\t\t\t\t\t{banner.content}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t{#if banner.url}\r\n\t\t\t\t<div class=\"hidden md:flex group w-fit md:items-center\">\r\n\t\t\t\t\t<a\r\n\t\t\t\t\t\tclass=\"text-gray-700 dark:text-white text-xs font-bold underline\"\r\n\t\t\t\t\t\thref=\"/\"\r\n\t\t\t\t\t\ttarget=\"_blank\">Learn More</a\r\n\t\t\t\t\t>\r\n\r\n\t\t\t\t\t<div class=\" ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white\">\r\n\t\t\t\t\t\t<!--  -->\r\n\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\r\n\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\tclass=\"size-4\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\r\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t{/if}\r\n\t\t\t<div class=\"flex self-start\">\r\n\t\t\t\t{#if banner.dismissible}\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\ton:click={() => {\r\n\t\t\t\t\t\t\tdismiss(banner.id);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tclass=\" -mt-[3px] ml-1.5 mr-1 text-gray-400 dark:hover:text-white h-1\">&times;</button\r\n\t\t\t\t\t>\r\n\t\t\t\t{/if}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t{/if}\r\n{/if}\r\n","<script lang=\"ts\">\r\n\timport { v4 as uuidv4 } from 'uuid';\r\n\timport { toast } from 'svelte-sonner';\r\n\timport mermaid from 'mermaid';\r\n\r\n\timport { getContext, onMount, tick } from 'svelte';\r\n\timport { goto } from '$app/navigation';\r\n\timport { page } from '$app/stores';\r\n\r\n\timport {\r\n\t\tchatId,\r\n\t\tchats,\r\n\t\tconfig,\r\n\t\ttype Model,\r\n\t\tmodels,\r\n\t\tsettings,\r\n\t\tshowSidebar,\r\n\t\ttags as _tags,\r\n\t\tWEBUI_NAME,\r\n\t\tbanners,\r\n\t\tuser,\r\n\t\tsocket\r\n\t} from '$lib/stores';\r\n\timport {\r\n\t\tconvertMessagesToHistory,\r\n\t\tcopyToClipboard,\r\n\t\tpromptTemplate,\r\n\t\tsplitStream\r\n\t} from '$lib/utils';\r\n\r\n\timport { generateChatCompletion } from '$lib/apis/ollama';\r\n\timport {\r\n\t\taddTagById,\r\n\t\tcreateNewChat,\r\n\t\tdeleteTagById,\r\n\t\tgetAllChatTags,\r\n\t\tgetChatById,\r\n\t\tgetChatList,\r\n\t\tgetTagsById,\r\n\t\tupdateChatById\r\n\t} from '$lib/apis/chats';\r\n\timport {\r\n\t\tgenerateOpenAIChatCompletion,\r\n\t\tgenerateSearchQuery,\r\n\t\tgenerateTitle\r\n\t} from '$lib/apis/openai';\r\n\r\n\timport MessageInput from '$lib/components/chat/MessageInput.svelte';\r\n\timport Messages from '$lib/components/chat/Messages.svelte';\r\n\timport Navbar from '$lib/components/layout/Navbar.svelte';\r\n\timport { OLLAMA_API_BASE_URL, OPENAI_API_BASE_URL, WEBUI_BASE_URL } from '$lib/constants';\r\n\timport { createOpenAITextStream } from '$lib/apis/streaming';\r\n\timport { queryMemory } from '$lib/apis/memories';\r\n\timport type { Writable } from 'svelte/store';\r\n\timport type { i18n as i18nType } from 'i18next';\r\n\timport { runWebSearch } from '$lib/apis/rag';\r\n\timport Banner from '../common/Banner.svelte';\r\n\timport { getUserSettings } from '$lib/apis/users';\r\n\timport { chatCompleted } from '$lib/apis';\r\n\r\n\tconst i18n: Writable<i18nType> = getContext('i18n');\r\n\r\n\texport let chatIdProp = '';\r\n\tlet loaded = false;\r\n\r\n\tlet stopResponseFlag = false;\r\n\tlet autoScroll = true;\r\n\tlet processing = '';\r\n\tlet messagesContainerElement: HTMLDivElement;\r\n\r\n\tlet showModelSelector = true;\r\n\r\n\tlet selectedModels = [''];\r\n\tlet atSelectedModel: Model | undefined;\r\n\r\n\tlet webSearchEnabled = false;\r\n\r\n\tlet chat = null;\r\n\tlet tags = [];\r\n\r\n\tlet title = '';\r\n\tlet prompt = '';\r\n\tlet files = [];\r\n\tlet messages = [];\r\n\tlet history = {\r\n\t\tmessages: {},\r\n\t\tcurrentId: null\r\n\t};\r\n\r\n\t$: if (history.currentId !== null) {\r\n\t\tlet _messages = [];\r\n\r\n\t\tlet currentMessage = history.messages[history.currentId];\r\n\t\twhile (currentMessage !== null) {\r\n\t\t\t_messages.unshift({ ...currentMessage });\r\n\t\t\tcurrentMessage =\r\n\t\t\t\tcurrentMessage.parentId !== null ? history.messages[currentMessage.parentId] : null;\r\n\t\t}\r\n\t\tmessages = _messages;\r\n\t} else {\r\n\t\tmessages = [];\r\n\t}\r\n\r\n\t$: if (chatIdProp) {\r\n\t\t(async () => {\r\n\t\t\tif (await loadChat()) {\r\n\t\t\t\tawait tick();\r\n\t\t\t\tloaded = true;\r\n\r\n\t\t\t\twindow.setTimeout(() => scrollToBottom(), 0);\r\n\t\t\t\tconst chatInput = document.getElementById('chat-textarea');\r\n\t\t\t\tchatInput?.focus();\r\n\t\t\t} else {\r\n\t\t\t\tawait goto('/');\r\n\t\t\t}\r\n\t\t})();\r\n\t}\r\n\r\n\tonMount(async () => {\r\n\t\tif (!$chatId) {\r\n\t\t\tawait initNewChat();\r\n\t\t} else {\r\n\t\t\tif (!($settings.saveChatHistory ?? true)) {\r\n\t\t\t\tawait goto('/');\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t//////////////////////////\r\n\t// Web functions\r\n\t//////////////////////////\r\n\r\n\tconst initNewChat = async () => {\r\n\t\twindow.history.replaceState(history.state, '', `/`);\r\n\t\tawait chatId.set('');\r\n\r\n\t\tautoScroll = true;\r\n\r\n\t\ttitle = '';\r\n\t\tmessages = [];\r\n\t\thistory = {\r\n\t\t\tmessages: {},\r\n\t\t\tcurrentId: null\r\n\t\t};\r\n\r\n\t\tif ($page.url.searchParams.get('models')) {\r\n\t\t\tselectedModels = $page.url.searchParams.get('models')?.split(',');\r\n\t\t} else if ($settings?.models) {\r\n\t\t\tselectedModels = $settings?.models;\r\n\t\t} else if ($config?.default_models) {\r\n\t\t\tconsole.log($config?.default_models.split(',') ?? '');\r\n\t\t\tselectedModels = $config?.default_models.split(',');\r\n\t\t} else {\r\n\t\t\tselectedModels = [''];\r\n\t\t}\r\n\r\n\t\tif ($page.url.searchParams.get('q')) {\r\n\t\t\tprompt = $page.url.searchParams.get('q') ?? '';\r\n\r\n\t\t\tif (prompt) {\r\n\t\t\t\tawait tick();\r\n\t\t\t\tsubmitPrompt(prompt);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tselectedModels = selectedModels.map((modelId) =>\r\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\r\n\t\t);\r\n\r\n\t\tconst userSettings = await getUserSettings(localStorage.token);\r\n\r\n\t\tif (userSettings) {\r\n\t\t\tsettings.set(userSettings.ui);\r\n\t\t} else {\r\n\t\t\tsettings.set(JSON.parse(localStorage.getItem('settings') ?? '{}'));\r\n\t\t}\r\n\r\n\t\tconst chatInput = document.getElementById('chat-textarea');\r\n\t\tsetTimeout(() => chatInput?.focus(), 0);\r\n\t};\r\n\r\n\tconst loadChat = async () => {\r\n\t\tchatId.set(chatIdProp);\r\n\t\tchat = await getChatById(localStorage.token, $chatId).catch(async (error) => {\r\n\t\t\tawait goto('/');\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (chat) {\r\n\t\t\ttags = await getTags();\r\n\t\t\tconst chatContent = chat.chat;\r\n\r\n\t\t\tif (chatContent) {\r\n\t\t\t\tconsole.log(chatContent);\r\n\r\n\t\t\t\tselectedModels =\r\n\t\t\t\t\t(chatContent?.models ?? undefined) !== undefined\r\n\t\t\t\t\t\t? chatContent.models\r\n\t\t\t\t\t\t: [chatContent.models ?? ''];\r\n\t\t\t\thistory =\r\n\t\t\t\t\t(chatContent?.history ?? undefined) !== undefined\r\n\t\t\t\t\t\t? chatContent.history\r\n\t\t\t\t\t\t: convertMessagesToHistory(chatContent.messages);\r\n\t\t\t\ttitle = chatContent.title;\r\n\r\n\t\t\t\tconst userSettings = await getUserSettings(localStorage.token);\r\n\r\n\t\t\t\tif (userSettings) {\r\n\t\t\t\t\tawait settings.set(userSettings.ui);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tawait settings.set(JSON.parse(localStorage.getItem('settings') ?? '{}'));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tawait settings.set({\r\n\t\t\t\t\t...$settings,\r\n\t\t\t\t\tsystem: chatContent.system ?? $settings.system,\r\n\t\t\t\t\tparams: chatContent.options ?? $settings.params\r\n\t\t\t\t});\r\n\r\n\t\t\t\tautoScroll = true;\r\n\t\t\t\tawait tick();\r\n\r\n\t\t\t\tif (messages.length > 0) {\r\n\t\t\t\t\thistory.messages[messages.at(-1).id].done = true;\r\n\t\t\t\t}\r\n\t\t\t\tawait tick();\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst scrollToBottom = async () => {\r\n\t\tawait tick();\r\n\t\tif (messagesContainerElement) {\r\n\t\t\tmessagesContainerElement.scrollTop = messagesContainerElement.scrollHeight;\r\n\t\t}\r\n\t};\r\n\r\n\tconst createMessagesList = (responseMessageId) => {\r\n\t\tconst message = history.messages[responseMessageId];\r\n\t\tif (message.parentId) {\r\n\t\t\treturn [...createMessagesList(message.parentId), message];\r\n\t\t} else {\r\n\t\t\treturn [message];\r\n\t\t}\r\n\t};\r\n\r\n\tconst chatCompletedHandler = async (modelId, messages) => {\r\n\t\tawait mermaid.run({\r\n\t\t\tquerySelector: '.mermaid'\r\n\t\t});\r\n\r\n\t\tconst res = await chatCompleted(localStorage.token, {\r\n\t\t\tmodel: modelId,\r\n\t\t\tmessages: messages.map((m) => ({\r\n\t\t\t\tid: m.id,\r\n\t\t\t\trole: m.role,\r\n\t\t\t\tcontent: m.content,\r\n\t\t\t\ttimestamp: m.timestamp\r\n\t\t\t})),\r\n\t\t\tchat_id: $chatId\r\n\t\t}).catch((error) => {\r\n\t\t\tconsole.error(error);\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (res !== null) {\r\n\t\t\t// Update chat history with the new messages\r\n\t\t\tfor (const message of res.messages) {\r\n\t\t\t\thistory.messages[message.id] = {\r\n\t\t\t\t\t...history.messages[message.id],\r\n\t\t\t\t\t...(history.messages[message.id].content !== message.content\r\n\t\t\t\t\t\t? { originalContent: history.messages[message.id].content }\r\n\t\t\t\t\t\t: {}),\r\n\t\t\t\t\t...message\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst getChatEventEmitter = async (modelId: string, chatId: string = '') => {\r\n\t\treturn setInterval(() => {\r\n\t\t\t$socket?.emit('usage', {\r\n\t\t\t\taction: 'chat',\r\n\t\t\t\tmodel: modelId,\r\n\t\t\t\tchat_id: chatId\r\n\t\t\t});\r\n\t\t}, 1000);\r\n\t};\r\n\r\n\t//////////////////////////\r\n\t// Ollama functions\r\n\t//////////////////////////\r\n\r\n\tconst submitPrompt = async (userPrompt, _user = null) => {\r\n\t\tconsole.log('submitPrompt', $chatId);\r\n\r\n\t\tselectedModels = selectedModels.map((modelId) =>\r\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\r\n\t\t);\r\n\r\n\t\tif (selectedModels.includes('')) {\r\n\t\t\ttoast.error($i18n.t('Model not selected'));\r\n\t\t} else if (messages.length != 0 && messages.at(-1).done != true) {\r\n\t\t\t// Response not done\r\n\t\t\tconsole.log('wait');\r\n\t\t} else if (\r\n\t\t\tfiles.length > 0 &&\r\n\t\t\tfiles.filter((file) => file.upload_status === false).length > 0\r\n\t\t) {\r\n\t\t\t// Upload not done\r\n\t\t\ttoast.error(\r\n\t\t\t\t$i18n.t(\r\n\t\t\t\t\t`Oops! Hold tight! Your files are still in the processing oven. We're cooking them up to perfection. Please be patient and we'll let you know once they're ready.`\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\t// Reset chat message textarea height\r\n\t\t\tdocument.getElementById('chat-textarea').style.height = '';\r\n\r\n\t\t\t// Create user message\r\n\t\t\tlet userMessageId = uuidv4();\r\n\t\t\tlet userMessage = {\r\n\t\t\t\tid: userMessageId,\r\n\t\t\t\tparentId: messages.length !== 0 ? messages.at(-1).id : null,\r\n\t\t\t\tchildrenIds: [],\r\n\t\t\t\trole: 'user',\r\n\t\t\t\tuser: _user ?? undefined,\r\n\t\t\t\tcontent: userPrompt,\r\n\t\t\t\tfiles: files.length > 0 ? files : undefined,\r\n\t\t\t\ttimestamp: Math.floor(Date.now() / 1000), // Unix epoch\r\n\t\t\t\tmodels: selectedModels.filter((m, mIdx) => selectedModels.indexOf(m) === mIdx)\r\n\t\t\t};\r\n\r\n\t\t\t// Add message to history and Set currentId to messageId\r\n\t\t\thistory.messages[userMessageId] = userMessage;\r\n\t\t\thistory.currentId = userMessageId;\r\n\r\n\t\t\t// Append messageId to childrenIds of parent message\r\n\t\t\tif (messages.length !== 0) {\r\n\t\t\t\thistory.messages[messages.at(-1).id].childrenIds.push(userMessageId);\r\n\t\t\t}\r\n\r\n\t\t\t// Wait until history/message have been updated\r\n\t\t\tawait tick();\r\n\r\n\t\t\t// Create new chat if only one message in messages\r\n\t\t\tif (messages.length == 1) {\r\n\t\t\t\tif ($settings.saveChatHistory ?? true) {\r\n\t\t\t\t\tchat = await createNewChat(localStorage.token, {\r\n\t\t\t\t\t\tid: $chatId,\r\n\t\t\t\t\t\ttitle: $i18n.t('New Chat'),\r\n\t\t\t\t\t\tmodels: selectedModels,\r\n\t\t\t\t\t\tsystem: $settings.system ?? undefined,\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\t...($settings.params ?? {})\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tmessages: messages,\r\n\t\t\t\t\t\thistory: history,\r\n\t\t\t\t\t\ttags: [],\r\n\t\t\t\t\t\ttimestamp: Date.now()\r\n\t\t\t\t\t});\r\n\t\t\t\t\tawait chats.set(await getChatList(localStorage.token));\r\n\t\t\t\t\tawait chatId.set(chat.id);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tawait chatId.set('local');\r\n\t\t\t\t}\r\n\t\t\t\tawait tick();\r\n\t\t\t}\r\n\r\n\t\t\t// Reset chat input textarea\r\n\t\t\tprompt = '';\r\n\t\t\tdocument.getElementById('chat-textarea').style.height = '';\r\n\t\t\tfiles = [];\r\n\r\n\t\t\t// Send prompt\r\n\t\t\tawait sendPrompt(userPrompt, userMessageId);\r\n\t\t}\r\n\t};\r\n\r\n\tconst sendPrompt = async (prompt, parentId, modelId = null) => {\r\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\r\n\r\n\t\tawait Promise.all(\r\n\t\t\t(modelId\r\n\t\t\t\t? [modelId]\r\n\t\t\t\t: atSelectedModel !== undefined\r\n\t\t\t\t? [atSelectedModel.id]\r\n\t\t\t\t: selectedModels\r\n\t\t\t).map(async (modelId) => {\r\n\t\t\t\tconsole.log('modelId', modelId);\r\n\t\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\r\n\r\n\t\t\t\tif (model) {\r\n\t\t\t\t\t// If there are image files, check if model is vision capable\r\n\t\t\t\t\tconst hasImages = messages.some((message) =>\r\n\t\t\t\t\t\tmessage.files?.some((file) => file.type === 'image')\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif (hasImages && !(model.info?.meta?.capabilities?.vision ?? true)) {\r\n\t\t\t\t\t\ttoast.error(\r\n\t\t\t\t\t\t\t$i18n.t('Model {{modelName}} is not vision capable', {\r\n\t\t\t\t\t\t\t\tmodelName: model.name ?? model.id\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Create response message\r\n\t\t\t\t\tlet responseMessageId = uuidv4();\r\n\t\t\t\t\tlet responseMessage = {\r\n\t\t\t\t\t\tparentId: parentId,\r\n\t\t\t\t\t\tid: responseMessageId,\r\n\t\t\t\t\t\tchildrenIds: [],\r\n\t\t\t\t\t\trole: 'assistant',\r\n\t\t\t\t\t\tcontent: '',\r\n\t\t\t\t\t\tmodel: model.id,\r\n\t\t\t\t\t\tmodelName: model.name ?? model.id,\r\n\t\t\t\t\t\tuserContext: null,\r\n\t\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000) // Unix epoch\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Add message to history and Set currentId to messageId\r\n\t\t\t\t\thistory.messages[responseMessageId] = responseMessage;\r\n\t\t\t\t\thistory.currentId = responseMessageId;\r\n\r\n\t\t\t\t\t// Append messageId to childrenIds of parent message\r\n\t\t\t\t\tif (parentId !== null) {\r\n\t\t\t\t\t\thistory.messages[parentId].childrenIds = [\r\n\t\t\t\t\t\t\t...history.messages[parentId].childrenIds,\r\n\t\t\t\t\t\t\tresponseMessageId\r\n\t\t\t\t\t\t];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tawait tick();\r\n\r\n\t\t\t\t\tlet userContext = null;\r\n\t\t\t\t\tif ($settings?.memory ?? false) {\r\n\t\t\t\t\t\tif (userContext === null) {\r\n\t\t\t\t\t\t\tconst res = await queryMemory(localStorage.token, prompt).catch((error) => {\r\n\t\t\t\t\t\t\t\ttoast.error(error);\r\n\t\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tif (res) {\r\n\t\t\t\t\t\t\t\tif (res.documents[0].length > 0) {\r\n\t\t\t\t\t\t\t\t\tuserContext = res.documents.reduce((acc, doc, index) => {\r\n\t\t\t\t\t\t\t\t\t\tconst createdAtTimestamp = res.metadatas[index][0].created_at;\r\n\t\t\t\t\t\t\t\t\t\tconst createdAtDate = new Date(createdAtTimestamp * 1000)\r\n\t\t\t\t\t\t\t\t\t\t\t.toISOString()\r\n\t\t\t\t\t\t\t\t\t\t\t.split('T')[0];\r\n\t\t\t\t\t\t\t\t\t\tacc.push(`${index + 1}. [${createdAtDate}]. ${doc[0]}`);\r\n\t\t\t\t\t\t\t\t\t\treturn acc;\r\n\t\t\t\t\t\t\t\t\t}, []);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tconsole.log(userContext);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresponseMessage.userContext = userContext;\r\n\r\n\t\t\t\t\tconst chatEventEmitter = await getChatEventEmitter(model.id, _chatId);\r\n\r\n\t\t\t\t\tif (webSearchEnabled) {\r\n\t\t\t\t\t\tawait getWebSearchResults(model.id, parentId, responseMessageId);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (model?.owned_by === 'openai') {\r\n\t\t\t\t\t\tawait sendPromptOpenAI(model, prompt, responseMessageId, _chatId);\r\n\t\t\t\t\t} else if (model) {\r\n\t\t\t\t\t\tawait sendPromptOllama(model, prompt, responseMessageId, _chatId);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconsole.log('chatEventEmitter', chatEventEmitter);\r\n\r\n\t\t\t\t\tif (chatEventEmitter) clearInterval(chatEventEmitter);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoast.error($i18n.t(`Model {{modelId}} not found`, { modelId }));\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\r\n\t\tawait chats.set(await getChatList(localStorage.token));\r\n\t};\r\n\r\n\tconst getWebSearchResults = async (model: string, parentId: string, responseId: string) => {\r\n\t\tconst responseMessage = history.messages[responseId];\r\n\r\n\t\tresponseMessage.status = {\r\n\t\t\tdone: false,\r\n\t\t\taction: 'web_search',\r\n\t\t\tdescription: $i18n.t('Generating search query')\r\n\t\t};\r\n\t\tmessages = messages;\r\n\r\n\t\tconst prompt = history.messages[parentId].content;\r\n\t\tlet searchQuery = prompt;\r\n\t\tif (prompt.length > 100) {\r\n\t\t\tsearchQuery = await generateChatSearchQuery(model, prompt);\r\n\t\t\tif (!searchQuery) {\r\n\t\t\t\ttoast.warning($i18n.t('No search query generated'));\r\n\t\t\t\tresponseMessage.status = {\r\n\t\t\t\t\t...responseMessage.status,\r\n\t\t\t\t\tdone: true,\r\n\t\t\t\t\terror: true,\r\n\t\t\t\t\tdescription: 'No search query generated'\r\n\t\t\t\t};\r\n\t\t\t\tmessages = messages;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tresponseMessage.status = {\r\n\t\t\t...responseMessage.status,\r\n\t\t\tdescription: $i18n.t(\"Searching the web for '{{searchQuery}}'\", { searchQuery })\r\n\t\t};\r\n\t\tmessages = messages;\r\n\r\n\t\tconst results = await runWebSearch(localStorage.token, searchQuery).catch((error) => {\r\n\t\t\tconsole.log(error);\r\n\t\t\ttoast.error(error);\r\n\r\n\t\t\treturn null;\r\n\t\t});\r\n\r\n\t\tif (results) {\r\n\t\t\tresponseMessage.status = {\r\n\t\t\t\t...responseMessage.status,\r\n\t\t\t\tdone: true,\r\n\t\t\t\tdescription: $i18n.t('Searched {{count}} sites', { count: results.filenames.length }),\r\n\t\t\t\turls: results.filenames\r\n\t\t\t};\r\n\r\n\t\t\tif (responseMessage?.files ?? undefined === undefined) {\r\n\t\t\t\tresponseMessage.files = [];\r\n\t\t\t}\r\n\r\n\t\t\tresponseMessage.files.push({\r\n\t\t\t\tcollection_name: results.collection_name,\r\n\t\t\t\tname: searchQuery,\r\n\t\t\t\ttype: 'web_search_results',\r\n\t\t\t\turls: results.filenames\r\n\t\t\t});\r\n\r\n\t\t\tmessages = messages;\r\n\t\t} else {\r\n\t\t\tresponseMessage.status = {\r\n\t\t\t\t...responseMessage.status,\r\n\t\t\t\tdone: true,\r\n\t\t\t\terror: true,\r\n\t\t\t\tdescription: 'No search results found'\r\n\t\t\t};\r\n\t\t\tmessages = messages;\r\n\t\t}\r\n\t};\r\n\r\n\tconst sendPromptOllama = async (model, userPrompt, responseMessageId, _chatId) => {\r\n\t\tmodel = model.id;\r\n\r\n\t\tconst responseMessage = history.messages[responseMessageId];\r\n\r\n\t\t// Wait until history/message have been updated\r\n\t\tawait tick();\r\n\r\n\t\t// Scroll down\r\n\t\tscrollToBottom();\r\n\r\n\t\tconst messagesBody = [\r\n\t\t\t$settings.system || (responseMessage?.userContext ?? null)\r\n\t\t\t\t? {\r\n\t\t\t\t\t\trole: 'system',\r\n\t\t\t\t\t\tcontent: `${promptTemplate($settings?.system ?? '', $user.name)}${\r\n\t\t\t\t\t\t\tresponseMessage?.userContext ?? null\r\n\t\t\t\t\t\t\t\t? `\\n\\nUser Context:\\n${(responseMessage?.userContext ?? []).join('\\n')}`\r\n\t\t\t\t\t\t\t\t: ''\r\n\t\t\t\t\t\t}`\r\n\t\t\t\t  }\r\n\t\t\t\t: undefined,\r\n\t\t\t...messages\r\n\t\t]\r\n\t\t\t.filter((message) => message?.content?.trim())\r\n\t\t\t.map((message, idx, arr) => {\r\n\t\t\t\t// Prepare the base message object\r\n\t\t\t\tconst baseMessage = {\r\n\t\t\t\t\trole: message.role,\r\n\t\t\t\t\tcontent: message.content\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Extract and format image URLs if any exist\r\n\t\t\t\tconst imageUrls = message.files\r\n\t\t\t\t\t?.filter((file) => file.type === 'image')\r\n\t\t\t\t\t.map((file) => file.url.slice(file.url.indexOf(',') + 1));\r\n\r\n\t\t\t\t// Add images array only if it contains elements\r\n\t\t\t\tif (imageUrls && imageUrls.length > 0 && message.role === 'user') {\r\n\t\t\t\t\tbaseMessage.images = imageUrls;\r\n\t\t\t\t}\r\n\t\t\t\treturn baseMessage;\r\n\t\t\t});\r\n\r\n\t\tlet lastImageIndex = -1;\r\n\r\n\t\t// Find the index of the last object with images\r\n\t\tmessagesBody.forEach((item, index) => {\r\n\t\t\tif (item.images) {\r\n\t\t\t\tlastImageIndex = index;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Remove images from all but the last one\r\n\t\tmessagesBody.forEach((item, index) => {\r\n\t\t\tif (index !== lastImageIndex) {\r\n\t\t\t\tdelete item.images;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst docs = messages\r\n\t\t\t.filter((message) => message?.files ?? null)\r\n\t\t\t.map((message) =>\r\n\t\t\t\tmessage.files.filter((item) =>\r\n\t\t\t\t\t['doc', 'collection', 'web_search_results'].includes(item.type)\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t\t.flat(1);\r\n\r\n\t\tconst [res, controller] = await generateChatCompletion(localStorage.token, {\r\n\t\t\tmodel: model,\r\n\t\t\tmessages: messagesBody,\r\n\t\t\toptions: {\r\n\t\t\t\t...($settings.params ?? {}),\r\n\t\t\t\tstop:\r\n\t\t\t\t\t$settings?.params?.stop ?? undefined\r\n\t\t\t\t\t\t? $settings.params.stop.map((str) =>\r\n\t\t\t\t\t\t\t\tdecodeURIComponent(JSON.parse('\"' + str.replace(/\\\"/g, '\\\\\"') + '\"'))\r\n\t\t\t\t\t\t  )\r\n\t\t\t\t\t\t: undefined,\r\n\t\t\t\tnum_predict: $settings?.params?.max_tokens ?? undefined,\r\n\t\t\t\trepeat_penalty: $settings?.params?.frequency_penalty ?? undefined\r\n\t\t\t},\r\n\t\t\tformat: $settings.requestFormat ?? undefined,\r\n\t\t\tkeep_alive: $settings.keepAlive ?? undefined,\r\n\t\t\tdocs: docs.length > 0 ? docs : undefined,\r\n\t\t\tcitations: docs.length > 0,\r\n\t\t\tchat_id: $chatId\r\n\t\t});\r\n\r\n\t\tif (res && res.ok) {\r\n\t\t\tconsole.log('controller', controller);\r\n\r\n\t\t\tconst reader = res.body\r\n\t\t\t\t.pipeThrough(new TextDecoderStream())\r\n\t\t\t\t.pipeThrough(splitStream('\\n'))\r\n\t\t\t\t.getReader();\r\n\r\n\t\t\twhile (true) {\r\n\t\t\t\tconst { value, done } = await reader.read();\r\n\t\t\t\tif (done || stopResponseFlag || _chatId !== $chatId) {\r\n\t\t\t\t\tresponseMessage.done = true;\r\n\t\t\t\t\tmessages = messages;\r\n\r\n\t\t\t\t\tif (stopResponseFlag) {\r\n\t\t\t\t\t\tcontroller.abort('User: Stop Response');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst messages = createMessagesList(responseMessageId);\r\n\t\t\t\t\t\tawait chatCompletedHandler(model, messages);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet lines = value.split('\\n');\r\n\r\n\t\t\t\t\tfor (const line of lines) {\r\n\t\t\t\t\t\tif (line !== '') {\r\n\t\t\t\t\t\t\tconsole.log(line);\r\n\t\t\t\t\t\t\tlet data = JSON.parse(line);\r\n\r\n\t\t\t\t\t\t\tif ('citations' in data) {\r\n\t\t\t\t\t\t\t\tresponseMessage.citations = data.citations;\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif ('detail' in data) {\r\n\t\t\t\t\t\t\t\tthrow data;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (data.done == false) {\r\n\t\t\t\t\t\t\t\tif (responseMessage.content == '' && data.message.content == '\\n') {\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tresponseMessage.content += data.message.content;\r\n\t\t\t\t\t\t\t\t\tmessages = messages;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tresponseMessage.done = true;\r\n\r\n\t\t\t\t\t\t\t\tif (responseMessage.content == '') {\r\n\t\t\t\t\t\t\t\t\tresponseMessage.error = {\r\n\t\t\t\t\t\t\t\t\t\tcode: 400,\r\n\t\t\t\t\t\t\t\t\t\tcontent: `Oops! No text generated from Ollama, Please try again.`\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tresponseMessage.context = data.context ?? null;\r\n\t\t\t\t\t\t\t\tresponseMessage.info = {\r\n\t\t\t\t\t\t\t\t\ttotal_duration: data.total_duration,\r\n\t\t\t\t\t\t\t\t\tload_duration: data.load_duration,\r\n\t\t\t\t\t\t\t\t\tsample_count: data.sample_count,\r\n\t\t\t\t\t\t\t\t\tsample_duration: data.sample_duration,\r\n\t\t\t\t\t\t\t\t\tprompt_eval_count: data.prompt_eval_count,\r\n\t\t\t\t\t\t\t\t\tprompt_eval_duration: data.prompt_eval_duration,\r\n\t\t\t\t\t\t\t\t\teval_count: data.eval_count,\r\n\t\t\t\t\t\t\t\t\teval_duration: data.eval_duration\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\tmessages = messages;\r\n\r\n\t\t\t\t\t\t\t\tif ($settings.notificationEnabled && !document.hasFocus()) {\r\n\t\t\t\t\t\t\t\t\tconst notification = new Notification(\r\n\t\t\t\t\t\t\t\t\t\tselectedModelfile\r\n\t\t\t\t\t\t\t\t\t\t\t? `${\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tselectedModelfile.title.charAt(0).toUpperCase() +\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tselectedModelfile.title.slice(1)\r\n\t\t\t\t\t\t\t\t\t\t\t  }`\r\n\t\t\t\t\t\t\t\t\t\t\t: `${model}`,\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tbody: responseMessage.content,\r\n\t\t\t\t\t\t\t\t\t\t\ticon: selectedModelfile?.imageUrl ?? `${WEBUI_BASE_URL}/static/favicon.png`\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif ($settings.responseAutoCopy) {\r\n\t\t\t\t\t\t\t\t\tcopyToClipboard(responseMessage.content);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif ($settings.responseAutoPlayback) {\r\n\t\t\t\t\t\t\t\t\tawait tick();\r\n\t\t\t\t\t\t\t\t\tdocument.getElementById(`speak-button-${responseMessage.id}`)?.click();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.log(error);\r\n\t\t\t\t\tif ('detail' in error) {\r\n\t\t\t\t\t\ttoast.error(error.detail);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (autoScroll) {\r\n\t\t\t\t\tscrollToBottom();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ($chatId == _chatId) {\r\n\t\t\t\tif ($settings.saveChatHistory ?? true) {\r\n\t\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\r\n\t\t\t\t\t\tmessages: messages,\r\n\t\t\t\t\t\thistory: history,\r\n\t\t\t\t\t\tmodels: selectedModels\r\n\t\t\t\t\t});\r\n\t\t\t\t\tawait chats.set(await getChatList(localStorage.token));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (res !== null) {\r\n\t\t\t\tconst error = await res.json();\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t\tif ('detail' in error) {\r\n\t\t\t\t\ttoast.error(error.detail);\r\n\t\t\t\t\tresponseMessage.error = { content: error.detail };\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoast.error(error.error);\r\n\t\t\t\t\tresponseMessage.error = { content: error.error };\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttoast.error(\r\n\t\t\t\t\t$i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, { provider: 'Ollama' })\r\n\t\t\t\t);\r\n\t\t\t\tresponseMessage.error = {\r\n\t\t\t\t\tcontent: $i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, {\r\n\t\t\t\t\t\tprovider: 'Ollama'\r\n\t\t\t\t\t})\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tresponseMessage.done = true;\r\n\t\t\tmessages = messages;\r\n\t\t}\r\n\r\n\t\tstopResponseFlag = false;\r\n\t\tawait tick();\r\n\r\n\t\tif (autoScroll) {\r\n\t\t\tscrollToBottom();\r\n\t\t}\r\n\r\n\t\tif (messages.length == 2 && messages.at(1).content !== '') {\r\n\t\t\twindow.history.replaceState(history.state, '', `/c/${_chatId}`);\r\n\t\t\tconst _title = await generateChatTitle(userPrompt);\r\n\t\t\tawait setChatTitle(_chatId, _title);\r\n\t\t}\r\n\t};\r\n\r\n\tconst sendPromptOpenAI = async (model, userPrompt, responseMessageId, _chatId) => {\r\n\t\tconst responseMessage = history.messages[responseMessageId];\r\n\r\n\t\tconst docs = messages\r\n\t\t\t.filter((message) => message?.files ?? null)\r\n\t\t\t.map((message) =>\r\n\t\t\t\tmessage.files.filter((item) =>\r\n\t\t\t\t\t['doc', 'collection', 'web_search_results'].includes(item.type)\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t\t.flat(1);\r\n\r\n\t\tconsole.log(docs);\r\n\r\n\t\tscrollToBottom();\r\n\r\n\t\ttry {\r\n\t\t\tconst [res, controller] = await generateOpenAIChatCompletion(\r\n\t\t\t\tlocalStorage.token,\r\n\t\t\t\t{\r\n\t\t\t\t\tmodel: model.id,\r\n\t\t\t\t\tstream: true,\r\n\t\t\t\t\tstream_options:\r\n\t\t\t\t\t\tmodel.info?.meta?.capabilities?.usage ?? false\r\n\t\t\t\t\t\t\t? {\r\n\t\t\t\t\t\t\t\t\tinclude_usage: true\r\n\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\tmessages: [\r\n\t\t\t\t\t\t$settings.system || (responseMessage?.userContext ?? null)\r\n\t\t\t\t\t\t\t? {\r\n\t\t\t\t\t\t\t\t\trole: 'system',\r\n\t\t\t\t\t\t\t\t\tcontent: `${promptTemplate($settings?.system ?? '', $user.name)}${\r\n\t\t\t\t\t\t\t\t\t\tresponseMessage?.userContext ?? null\r\n\t\t\t\t\t\t\t\t\t\t\t? `\\n\\nUser Context:\\n${(responseMessage?.userContext ?? []).join('\\n')}`\r\n\t\t\t\t\t\t\t\t\t\t\t: ''\r\n\t\t\t\t\t\t\t\t\t}`\r\n\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\t\t...messages\r\n\t\t\t\t\t]\r\n\t\t\t\t\t\t.filter((message) => message?.content?.trim())\r\n\t\t\t\t\t\t.map((message, idx, arr) => ({\r\n\t\t\t\t\t\t\trole: message.role,\r\n\t\t\t\t\t\t\t...((message.files?.filter((file) => file.type === 'image').length > 0 ?? false) &&\r\n\t\t\t\t\t\t\tmessage.role === 'user'\r\n\t\t\t\t\t\t\t\t? {\r\n\t\t\t\t\t\t\t\t\t\tcontent: [\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'text',\r\n\t\t\t\t\t\t\t\t\t\t\t\ttext:\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tarr.length - 1 !== idx\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? message.content\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: message?.raContent ?? message.content\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t...message.files\r\n\t\t\t\t\t\t\t\t\t\t\t\t.filter((file) => file.type === 'image')\r\n\t\t\t\t\t\t\t\t\t\t\t\t.map((file) => ({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'image_url',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\timage_url: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: file.url\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}))\r\n\t\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t\t: {\r\n\t\t\t\t\t\t\t\t\t\tcontent:\r\n\t\t\t\t\t\t\t\t\t\t\tarr.length - 1 !== idx\r\n\t\t\t\t\t\t\t\t\t\t\t\t? message.content\r\n\t\t\t\t\t\t\t\t\t\t\t\t: message?.raContent ?? message.content\r\n\t\t\t\t\t\t\t\t  })\r\n\t\t\t\t\t\t})),\r\n\t\t\t\t\tseed: $settings?.params?.seed ?? undefined,\r\n\t\t\t\t\tstop:\r\n\t\t\t\t\t\t$settings?.params?.stop ?? undefined\r\n\t\t\t\t\t\t\t? $settings.params.stop.map((str) =>\r\n\t\t\t\t\t\t\t\t\tdecodeURIComponent(JSON.parse('\"' + str.replace(/\\\"/g, '\\\\\"') + '\"'))\r\n\t\t\t\t\t\t\t  )\r\n\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\ttemperature: $settings?.params?.temperature ?? undefined,\r\n\t\t\t\t\ttop_p: $settings?.params?.top_p ?? undefined,\r\n\t\t\t\t\tfrequency_penalty: $settings?.params?.frequency_penalty ?? undefined,\r\n\t\t\t\t\tmax_tokens: $settings?.params?.max_tokens ?? undefined,\r\n\t\t\t\t\tdocs: docs.length > 0 ? docs : undefined,\r\n\t\t\t\t\tcitations: docs.length > 0,\r\n\t\t\t\t\tchat_id: $chatId\r\n\t\t\t\t},\r\n\t\t\t\t`${OPENAI_API_BASE_URL}`\r\n\t\t\t);\r\n\r\n\t\t\t// Wait until history/message have been updated\r\n\t\t\tawait tick();\r\n\r\n\t\t\tscrollToBottom();\r\n\r\n\t\t\tif (res && res.ok && res.body) {\r\n\t\t\t\tconst textStream = await createOpenAITextStream(res.body, $settings.splitLargeChunks);\r\n\t\t\t\tlet lastUsage = null;\r\n\r\n\t\t\t\tfor await (const update of textStream) {\r\n\t\t\t\t\tconst { value, done, citations, error, usage } = update;\r\n\t\t\t\t\tif (error) {\r\n\t\t\t\t\t\tawait handleOpenAIError(error, null, model, responseMessage);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (done || stopResponseFlag || _chatId !== $chatId) {\r\n\t\t\t\t\t\tresponseMessage.done = true;\r\n\t\t\t\t\t\tmessages = messages;\r\n\r\n\t\t\t\t\t\tif (stopResponseFlag) {\r\n\t\t\t\t\t\t\tcontroller.abort('User: Stop Response');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconst messages = createMessagesList(responseMessageId);\r\n\r\n\t\t\t\t\t\t\tawait chatCompletedHandler(model.id, messages);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (usage) {\r\n\t\t\t\t\t\tlastUsage = usage;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (citations) {\r\n\t\t\t\t\t\tresponseMessage.citations = citations;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (responseMessage.content == '' && value == '\\n') {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresponseMessage.content += value;\r\n\t\t\t\t\t\tmessages = messages;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (autoScroll) {\r\n\t\t\t\t\t\tscrollToBottom();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($settings.notificationEnabled && !document.hasFocus()) {\r\n\t\t\t\t\tconst notification = new Notification(`OpenAI ${model}`, {\r\n\t\t\t\t\t\tbody: responseMessage.content,\r\n\t\t\t\t\t\ticon: `${WEBUI_BASE_URL}/static/favicon.png`\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($settings.responseAutoCopy) {\r\n\t\t\t\t\tcopyToClipboard(responseMessage.content);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($settings.responseAutoPlayback) {\r\n\t\t\t\t\tawait tick();\r\n\t\t\t\t\tdocument.getElementById(`speak-button-${responseMessage.id}`)?.click();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (lastUsage) {\r\n\t\t\t\t\tresponseMessage.info = { ...lastUsage, openai: true };\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($chatId == _chatId) {\r\n\t\t\t\t\tif ($settings.saveChatHistory ?? true) {\r\n\t\t\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\r\n\t\t\t\t\t\t\tmodels: selectedModels,\r\n\t\t\t\t\t\t\tmessages: messages,\r\n\t\t\t\t\t\t\thistory: history\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tawait chats.set(await getChatList(localStorage.token));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tawait handleOpenAIError(null, res, model, responseMessage);\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tawait handleOpenAIError(error, null, model, responseMessage);\r\n\t\t}\r\n\t\tmessages = messages;\r\n\r\n\t\tstopResponseFlag = false;\r\n\t\tawait tick();\r\n\r\n\t\tif (autoScroll) {\r\n\t\t\tscrollToBottom();\r\n\t\t}\r\n\r\n\t\tif (messages.length == 2) {\r\n\t\t\twindow.history.replaceState(history.state, '', `/c/${_chatId}`);\r\n\r\n\t\t\tconst _title = await generateChatTitle(userPrompt);\r\n\t\t\tawait setChatTitle(_chatId, _title);\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleOpenAIError = async (error, res: Response | null, model, responseMessage) => {\r\n\t\tlet errorMessage = '';\r\n\t\tlet innerError;\r\n\r\n\t\tif (error) {\r\n\t\t\tinnerError = error;\r\n\t\t} else if (res !== null) {\r\n\t\t\tinnerError = await res.json();\r\n\t\t}\r\n\t\tconsole.error(innerError);\r\n\t\tif ('detail' in innerError) {\r\n\t\t\ttoast.error(innerError.detail);\r\n\t\t\terrorMessage = innerError.detail;\r\n\t\t} else if ('error' in innerError) {\r\n\t\t\tif ('message' in innerError.error) {\r\n\t\t\t\ttoast.error(innerError.error.message);\r\n\t\t\t\terrorMessage = innerError.error.message;\r\n\t\t\t} else {\r\n\t\t\t\ttoast.error(innerError.error);\r\n\t\t\t\terrorMessage = innerError.error;\r\n\t\t\t}\r\n\t\t} else if ('message' in innerError) {\r\n\t\t\ttoast.error(innerError.message);\r\n\t\t\terrorMessage = innerError.message;\r\n\t\t}\r\n\r\n\t\tresponseMessage.error = {\r\n\t\t\tcontent:\r\n\t\t\t\t$i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, {\r\n\t\t\t\t\tprovider: model.name ?? model.id\r\n\t\t\t\t}) +\r\n\t\t\t\t'\\n' +\r\n\t\t\t\terrorMessage\r\n\t\t};\r\n\t\tresponseMessage.done = true;\r\n\r\n\t\tmessages = messages;\r\n\t};\r\n\r\n\tconst stopResponse = () => {\r\n\t\tstopResponseFlag = true;\r\n\t\tconsole.log('stopResponse');\r\n\t};\r\n\r\n\tconst regenerateResponse = async (message) => {\r\n\t\tconsole.log('regenerateResponse');\r\n\r\n\t\tif (messages.length != 0) {\r\n\t\t\tlet userMessage = history.messages[message.parentId];\r\n\t\t\tlet userPrompt = userMessage.content;\r\n\r\n\t\t\tif ((userMessage?.models ?? [...selectedModels]).length == 1) {\r\n\t\t\t\tawait sendPrompt(userPrompt, userMessage.id);\r\n\t\t\t} else {\r\n\t\t\t\tawait sendPrompt(userPrompt, userMessage.id, message.model);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst continueGeneration = async () => {\r\n\t\tconsole.log('continueGeneration');\r\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\r\n\r\n\t\tif (messages.length != 0 && messages.at(-1).done == true) {\r\n\t\t\tconst responseMessage = history.messages[history.currentId];\r\n\t\t\tresponseMessage.done = false;\r\n\t\t\tawait tick();\r\n\r\n\t\t\tconst model = $models.filter((m) => m.id === responseMessage.model).at(0);\r\n\r\n\t\t\tif (model) {\r\n\t\t\t\tif (model?.owned_by === 'openai') {\r\n\t\t\t\t\tawait sendPromptOpenAI(\r\n\t\t\t\t\t\tmodel,\r\n\t\t\t\t\t\thistory.messages[responseMessage.parentId].content,\r\n\t\t\t\t\t\tresponseMessage.id,\r\n\t\t\t\t\t\t_chatId\r\n\t\t\t\t\t);\r\n\t\t\t\t} else\r\n\t\t\t\t\tawait sendPromptOllama(\r\n\t\t\t\t\t\tmodel,\r\n\t\t\t\t\t\thistory.messages[responseMessage.parentId].content,\r\n\t\t\t\t\t\tresponseMessage.id,\r\n\t\t\t\t\t\t_chatId\r\n\t\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\ttoast.error($i18n.t(`Model {{modelId}} not found`, { modelId }));\r\n\t\t}\r\n\t};\r\n\r\n\tconst generateChatTitle = async (userPrompt) => {\r\n\t\tif ($settings?.title?.auto ?? true) {\r\n\t\t\tconst model = $models.find((model) => model.id === selectedModels[0]);\r\n\r\n\t\t\tconst titleModelId =\r\n\t\t\t\tmodel?.owned_by === 'openai' ?? false\r\n\t\t\t\t\t? $settings?.title?.modelExternal ?? selectedModels[0]\r\n\t\t\t\t\t: $settings?.title?.model ?? selectedModels[0];\r\n\t\t\tconst titleModel = $models.find((model) => model.id === titleModelId);\r\n\r\n\t\t\tconsole.log(titleModel);\r\n\t\t\tconst title = await generateTitle(\r\n\t\t\t\tlocalStorage.token,\r\n\t\t\t\t$settings?.title?.prompt ??\r\n\t\t\t\t\t$i18n.t(\r\n\t\t\t\t\t\t\"Create a concise, 3-5 word phrase as a header for the following query, strictly adhering to the 3-5 word limit and avoiding the use of the word 'title':\"\r\n\t\t\t\t\t) + ' {{prompt}}',\r\n\t\t\t\ttitleModelId,\r\n\t\t\t\tuserPrompt,\r\n\t\t\t\t$chatId,\r\n\t\t\t\ttitleModel?.owned_by === 'openai' ?? false\r\n\t\t\t\t\t? `${OPENAI_API_BASE_URL}`\r\n\t\t\t\t\t: `${OLLAMA_API_BASE_URL}/v1`\r\n\t\t\t);\r\n\r\n\t\t\treturn title;\r\n\t\t} else {\r\n\t\t\treturn `${userPrompt}`;\r\n\t\t}\r\n\t};\r\n\r\n\tconst generateChatSearchQuery = async (modelId: string, prompt: string) => {\r\n\t\tconst model = $models.find((model) => model.id === modelId);\r\n\t\tconst taskModelId =\r\n\t\t\tmodel?.owned_by === 'openai' ?? false\r\n\t\t\t\t? $settings?.title?.modelExternal ?? modelId\r\n\t\t\t\t: $settings?.title?.model ?? modelId;\r\n\t\tconst taskModel = $models.find((model) => model.id === taskModelId);\r\n\r\n\t\tconst previousMessages = messages\r\n\t\t\t.filter((message) => message.role === 'user')\r\n\t\t\t.map((message) => message.content);\r\n\r\n\t\treturn await generateSearchQuery(\r\n\t\t\tlocalStorage.token,\r\n\t\t\ttaskModelId,\r\n\t\t\tpreviousMessages,\r\n\t\t\tprompt,\r\n\t\t\ttaskModel?.owned_by === 'openai' ?? false\r\n\t\t\t\t? `${OPENAI_API_BASE_URL}`\r\n\t\t\t\t: `${OLLAMA_API_BASE_URL}/v1`\r\n\t\t);\r\n\t};\r\n\r\n\tconst setChatTitle = async (_chatId, _title) => {\r\n\t\tif (_chatId === $chatId) {\r\n\t\t\ttitle = _title;\r\n\t\t}\r\n\r\n\t\tif ($settings.saveChatHistory ?? true) {\r\n\t\t\tchat = await updateChatById(localStorage.token, _chatId, { title: _title });\r\n\t\t\tawait chats.set(await getChatList(localStorage.token));\r\n\t\t}\r\n\t};\r\n\r\n\tconst getTags = async () => {\r\n\t\treturn await getTagsById(localStorage.token, $chatId).catch(async (error) => {\r\n\t\t\treturn [];\r\n\t\t});\r\n\t};\r\n\r\n\tconst addTag = async (tagName) => {\r\n\t\tconst res = await addTagById(localStorage.token, $chatId, tagName);\r\n\t\ttags = await getTags();\r\n\r\n\t\tchat = await updateChatById(localStorage.token, $chatId, {\r\n\t\t\ttags: tags\r\n\t\t});\r\n\r\n\t\t_tags.set(await getAllChatTags(localStorage.token));\r\n\t};\r\n\r\n\tconst deleteTag = async (tagName) => {\r\n\t\tconst res = await deleteTagById(localStorage.token, $chatId, tagName);\r\n\t\ttags = await getTags();\r\n\r\n\t\tchat = await updateChatById(localStorage.token, $chatId, {\r\n\t\t\ttags: tags\r\n\t\t});\r\n\r\n\t\t_tags.set(await getAllChatTags(localStorage.token));\r\n\t};\r\n</script>\r\n\r\n<svelte:head>\r\n\t<title>\r\n\t\t{title\r\n\t\t\t? `${title.length > 30 ? `${title.slice(0, 30)}...` : title} | ${$WEBUI_NAME}`\r\n\t\t\t: `${$WEBUI_NAME}`}\r\n\t</title>\r\n</svelte:head>\r\n\r\n{#if !chatIdProp || (loaded && chatIdProp)}\r\n\t<div\r\n\t\tclass=\"h-screen max-h-[100dvh] {$showSidebar\r\n\t\t\t? 'md:max-w-[calc(100%-260px)]'\r\n\t\t\t: ''} w-full max-w-full flex flex-col\"\r\n\t>\r\n\t\t<Navbar\r\n\t\t\t{title}\r\n\t\t\tbind:selectedModels\r\n\t\t\tbind:showModelSelector\r\n\t\t\tshareEnabled={messages.length > 0}\r\n\t\t\t{chat}\r\n\t\t\t{initNewChat}\r\n\t\t/>\r\n\r\n\t\t{#if $banners.length > 0 && messages.length === 0 && !$chatId && selectedModels.length <= 1}\r\n\t\t\t<div\r\n\t\t\t\tclass=\"absolute top-[4.25rem] w-full {$showSidebar ? 'md:max-w-[calc(100%-260px)]' : ''}\"\r\n\t\t\t>\r\n\t\t\t\t<div class=\" flex flex-col gap-1 w-full\">\r\n\t\t\t\t\t{#each $banners.filter( (b) => (b.dismissible ? !JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]').includes(b.id) : true) ) as banner}\r\n\t\t\t\t\t\t<Banner\r\n\t\t\t\t\t\t\t{banner}\r\n\t\t\t\t\t\t\ton:dismiss={(e) => {\r\n\t\t\t\t\t\t\t\tconst bannerId = e.detail;\r\n\r\n\t\t\t\t\t\t\t\tlocalStorage.setItem(\r\n\t\t\t\t\t\t\t\t\t'dismissedBannerIds',\r\n\t\t\t\t\t\t\t\t\tJSON.stringify(\r\n\t\t\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t\t\tbannerId,\r\n\t\t\t\t\t\t\t\t\t\t\t...JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]')\r\n\t\t\t\t\t\t\t\t\t\t].filter((id) => $banners.find((b) => b.id === id))\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t{/each}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t{/if}\r\n\r\n\t\t<div class=\"flex flex-col flex-auto\">\r\n\t\t\t<div\r\n\t\t\t\tclass=\" pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full\"\r\n\t\t\t\tid=\"messages-container\"\r\n\t\t\t\tbind:this={messagesContainerElement}\r\n\t\t\t\ton:scroll={(e) => {\r\n\t\t\t\t\tautoScroll =\r\n\t\t\t\t\t\tmessagesContainerElement.scrollHeight - messagesContainerElement.scrollTop <=\r\n\t\t\t\t\t\tmessagesContainerElement.clientHeight + 5;\r\n\t\t\t\t}}\r\n\t\t\t>\r\n\t\t\t\t<div class=\" h-full w-full flex flex-col {chatIdProp ? 'py-4' : 'pt-2 pb-4'}\">\r\n\t\t\t\t\t<Messages\r\n\t\t\t\t\t\tchatId={$chatId}\r\n\t\t\t\t\t\t{selectedModels}\r\n\t\t\t\t\t\t{processing}\r\n\t\t\t\t\t\tbind:history\r\n\t\t\t\t\t\tbind:messages\r\n\t\t\t\t\t\tbind:autoScroll\r\n\t\t\t\t\t\tbind:prompt\r\n\t\t\t\t\t\tbottomPadding={files.length > 0}\r\n\t\t\t\t\t\t{sendPrompt}\r\n\t\t\t\t\t\t{continueGeneration}\r\n\t\t\t\t\t\t{regenerateResponse}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<MessageInput\r\n\t\t\t\tbind:files\r\n\t\t\t\tbind:prompt\r\n\t\t\t\tbind:autoScroll\r\n\t\t\t\tbind:webSearchEnabled\r\n\t\t\t\tbind:atSelectedModel\r\n\t\t\t\t{selectedModels}\r\n\t\t\t\t{messages}\r\n\t\t\t\t{submitPrompt}\r\n\t\t\t\t{stopResponse}\r\n\t\t\t/>\r\n\t\t</div>\r\n\t</div>\r\n{/if}\r\n"],"names":["ctx","disabled","$$props","open","onOpenChange","updateOption","ids","subOpen","setSubMenuCtx","next","$$invalidate","idValues","derived","$menuId","$triggerId","div_levels","insert_hydration","target","div","anchor","transition","transitionConfig","inTransition","inTransitionConfig","outTransition","outTransitionConfig","asChild","id","side","align","sideOffset","alignOffset","collisionPadding","avoidCollisions","collisionBoundary","sameWidth","fitViewport","strategy","overlap","el","subMenu","getAttrs","getSubmenuCtx","dispatch","createDispatcher","attrs","$$value","builder","$subMenu","updateSubPositioning","subTrigger","options","getSubTrigger","disabledStore","$subTrigger","disabledAttrs","$disabledStore","i","div8","append_hydration","div7","div1","div6","div2","div5","div3","div4","set_data","t4","t4_value","t0_value","t2_value","attr","button","button_class_value","div0","dirty","t0","t2","create_if_block","i18n","getContext","prompt","selectedCommandIdx","filteredPromptCommands","selectUp","selectDown","confirmCommand","command","text","clipboardText","err","toast","$i18n","chatInputElement","tick","words","findWordIndices","word","commandIdx","$prompts","a","b","show_if","func","show_if_1","_b","_a","t1_value","t3_value","t6_value","t1","t3","t6","create_if_block_3","s","createEventDispatcher","selectedIdx","filteredItems","filteredDocs","collections","confirmSelect","doc","removeFirstHashWord","confirmSelectWeb","url","confirmSelectYoutube","docIdx","isValidHttpUrl","$documents","e","arr","tag","filteredCollections","collection","create_if_block_1","user","chatInputPlaceholder","messages","filteredModels","model","modelIdx","$models","p","svg","path","className","strokeWidth","path0","path1","hr","flyAndScale","uploadFilesHandler","webSearchEnabled","onClose","show","value","src_url_equal","img","img_src_value","_c","WEBUI_BASE_URL","span","current","each_blocks","create_if_block_7","create_if_block_5","style","circle0","circle1","circle2","is_function","create_if_block_2","button_disabled_value","create_if_block_13","if_block1","create_if_block_12","show_if_2","if_block3","create_if_block_9","textarea","textarea_placeholder_value","div11","div10","div9","input","form","t10","t10_value","submitPrompt","stopResponse","autoScroll","atSelectedModel","selectedModels","chatTextAreaElement","filesInputElement","promptsElement","documentsElement","modelsElement","inputFiles","dragged","files","speechRecognitionEnabled","speechRecognition","visionCapableModels","mediaRecorder","audioChunks","isRecording","MIN_DECIBELS","scrollToBottom","element","startRecording","stream","event","audioBlob","file","blobToFile","res","transcribeAudio","error","$settings","monitorSilence","audioContext","audioStreamSource","analyser","bufferLength","domainData","lastSoundTime","detectSound","speechRecognitionHandler","inactivityTimeout","timeoutId","transcript","uploadDoc","blob","uploadDocToVectorDB","f","uploadWeb","uploadWebToVectorDB","uploadYoutubeTranscription","uploadYoutubeTranscriptionToVectorDB","onMount","dropZone","handleKeyDown","onDragOver","onDragLeave","onDrop","reader","SUPPORTED_FILE_TYPE","SUPPORTED_FILE_EXTENSIONS","func_1","fileIdx","$mobile","isCtrlPressed","regenerateButton","userMessageElement","editButton","commandOptionButton","fullPrompt","clipboardData","item","_d","m","selector_changes","t","t_value","if_block","showSetDefault","saveDefaultModel","it","settings","updateUserSettings","selectedModelIdx","tags","Tags","tags_changes","saveAs","fileSaver","shareEnabled","shareHandler","downloadHandler","chat","downloadTxt","_chat","chatText","message","downloadPdf","downloadChatAsPDF","downloadJSONExport","usermenu_changes","if_block2","nav","initNewChat","title","$WEBUI_NAME","showModelSelector","showShareChatModal","showDownloadChatModal","showSidebar","$showSidebar","showArchivedChats","createParser","onParse","isFirstChunk","buffer","startingPosition","startingFieldLength","eventId","eventName","data","reset","feed","chunk","hasBom","BOM","length","position","discardTrailingNewline","lineLength","fieldLength","character","index","parseEventStreamLine","lineBuffer","noValue","field","step","valueLength","retry","charCode","EventSourceParserStream","parser","controller","createOpenAITextStream","responseBody","splitLargeDeltas","eventStream","iterator","openAIStreamToIterator","streamLargeDeltasAsRandomChunks","done","parsedData","textStreamUpdate","content","chunkSize","sleep","ms","resolve","if_block0","create_if_block_4","div0_class_value","div5_transition","create_bidirectional_transition","fade","banner","dismissed","mounted","classNames","dismiss","each_value","ensure_array_like","processing","chatIdProp","loaded","stopResponseFlag","messagesContainerElement","history","$chatId","goto","chatId","$page","$config","modelId","userSettings","getUserSettings","chatInput","loadChat","getChatById","getTags","chatContent","convertMessagesToHistory","createMessagesList","responseMessageId","chatCompletedHandler","mermaid","chatCompleted","getChatEventEmitter","$socket","userPrompt","_user","userMessageId","uuidv4","userMessage","mIdx","createNewChat","chats","getChatList","sendPrompt","parentId","_chatId","responseMessage","userContext","queryMemory","acc","createdAtTimestamp","createdAtDate","chatEventEmitter","getWebSearchResults","sendPromptOpenAI","sendPromptOllama","responseId","searchQuery","generateChatSearchQuery","results","runWebSearch","messagesBody","promptTemplate","$user","idx","baseMessage","imageUrls","lastImageIndex","docs","generateChatCompletion","str","splitStream","lines","line","notification","copyToClipboard","updateChatById","_title","generateChatTitle","setChatTitle","generateOpenAIChatCompletion","_e","_f","_g","_h","_i","OPENAI_API_BASE_URL","textStream","lastUsage","update","citations","usage","handleOpenAIError","_j","errorMessage","innerError","regenerateResponse","continueGeneration","titleModelId","titleModel","generateTitle","OLLAMA_API_BASE_URL","taskModelId","taskModel","previousMessages","generateSearchQuery","getTagsById","bannerId","$banners","_messages","currentMessage"],"mappings":"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","x_google_ignoreList":[0,1,2,14,15]}