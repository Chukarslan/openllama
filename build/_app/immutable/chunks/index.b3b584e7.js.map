{"version":3,"file":"index.b3b584e7.js","sources":["../../../../../../node_modules/uuid/dist/esm-browser/rng.js","../../../../../../node_modules/uuid/dist/esm-browser/stringify.js","../../../../../../node_modules/uuid/dist/esm-browser/native.js","../../../../../../node_modules/uuid/dist/esm-browser/v4.js","../../../../../../src/lib/utils/index.ts"],"sourcesContent":["// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).slice(1));\n}\n\nexport function unsafeStringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  return byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]];\n}\n\nfunction stringify(arr, offset = 0) {\n  const uuid = unsafeStringify(arr, offset); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default {\n  randomUUID\n};","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  if (native.randomUUID && !buf && !options) {\n    return native.randomUUID();\n  }\n\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return unsafeStringify(rnds);\n}\n\nexport default v4;","import { v4 as uuidv4 } from 'uuid';\r\nimport sha256 from 'js-sha256';\r\n\r\n//////////////////////////\r\n// Helper functions\r\n//////////////////////////\r\n\r\nexport const sanitizeResponseContent = (content: string) => {\r\n\treturn content\r\n\t\t.replace(/<\\|[a-z]*$/, '')\r\n\t\t.replace(/<\\|[a-z]+\\|$/, '')\r\n\t\t.replace(/<$/, '')\r\n\t\t.replaceAll(/<\\|[a-z]+\\|>/g, ' ')\r\n\t\t.replaceAll('<', '&lt;')\r\n\t\t.replaceAll('>', '&gt;')\r\n\t\t.trim();\r\n};\r\n\r\nexport const revertSanitizedResponseContent = (content: string) => {\r\n\treturn content.replaceAll('&lt;', '<').replaceAll('&gt;', '>');\r\n};\r\n\r\nexport const capitalizeFirstLetter = (string) => {\r\n\treturn string.charAt(0).toUpperCase() + string.slice(1);\r\n};\r\n\r\nexport const splitStream = (splitOn) => {\r\n\tlet buffer = '';\r\n\treturn new TransformStream({\r\n\t\ttransform(chunk, controller) {\r\n\t\t\tbuffer += chunk;\r\n\t\t\tconst parts = buffer.split(splitOn);\r\n\t\t\tparts.slice(0, -1).forEach((part) => controller.enqueue(part));\r\n\t\t\tbuffer = parts[parts.length - 1];\r\n\t\t},\r\n\t\tflush(controller) {\r\n\t\t\tif (buffer) controller.enqueue(buffer);\r\n\t\t}\r\n\t});\r\n};\r\n\r\nexport const convertMessagesToHistory = (messages) => {\r\n\tconst history = {\r\n\t\tmessages: {},\r\n\t\tcurrentId: null\r\n\t};\r\n\r\n\tlet parentMessageId = null;\r\n\tlet messageId = null;\r\n\r\n\tfor (const message of messages) {\r\n\t\tmessageId = uuidv4();\r\n\r\n\t\tif (parentMessageId !== null) {\r\n\t\t\thistory.messages[parentMessageId].childrenIds = [\r\n\t\t\t\t...history.messages[parentMessageId].childrenIds,\r\n\t\t\t\tmessageId\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\thistory.messages[messageId] = {\r\n\t\t\t...message,\r\n\t\t\tid: messageId,\r\n\t\t\tparentId: parentMessageId,\r\n\t\t\tchildrenIds: []\r\n\t\t};\r\n\r\n\t\tparentMessageId = messageId;\r\n\t}\r\n\r\n\thistory.currentId = messageId;\r\n\treturn history;\r\n};\r\n\r\nexport const getGravatarURL = (email) => {\r\n\t// Trim leading and trailing whitespace from\r\n\t// an email address and force all characters\r\n\t// to lower case\r\n\tconst address = String(email).trim().toLowerCase();\r\n\r\n\t// Create a SHA256 hash of the final string\r\n\tconst hash = sha256(address);\r\n\r\n\t// Grab the actual image URL\r\n\treturn `https://www.gravatar.com/avatar/${hash}`;\r\n};\r\n\r\nexport const canvasPixelTest = () => {\r\n\t// Test a 1x1 pixel to potentially identify browser/plugin fingerprint blocking or spoofing\r\n\t// Inspiration: https://github.com/kkapsner/CanvasBlocker/blob/master/test/detectionTest.js\r\n\tconst canvas = document.createElement('canvas');\r\n\tconst ctx = canvas.getContext('2d');\r\n\tcanvas.height = 1;\r\n\tcanvas.width = 1;\r\n\tconst imageData = new ImageData(canvas.width, canvas.height);\r\n\tconst pixelValues = imageData.data;\r\n\r\n\t// Generate RGB test data\r\n\tfor (let i = 0; i < imageData.data.length; i += 1) {\r\n\t\tif (i % 4 !== 3) {\r\n\t\t\tpixelValues[i] = Math.floor(256 * Math.random());\r\n\t\t} else {\r\n\t\t\tpixelValues[i] = 255;\r\n\t\t}\r\n\t}\r\n\r\n\tctx.putImageData(imageData, 0, 0);\r\n\tconst p = ctx.getImageData(0, 0, canvas.width, canvas.height).data;\r\n\r\n\t// Read RGB data and fail if unmatched\r\n\tfor (let i = 0; i < p.length; i += 1) {\r\n\t\tif (p[i] !== pixelValues[i]) {\r\n\t\t\tconsole.log(\r\n\t\t\t\t'canvasPixelTest: Wrong canvas pixel RGB value detected:',\r\n\t\t\t\tp[i],\r\n\t\t\t\t'at:',\r\n\t\t\t\ti,\r\n\t\t\t\t'expected:',\r\n\t\t\t\tpixelValues[i]\r\n\t\t\t);\r\n\t\t\tconsole.log('canvasPixelTest: Canvas blocking or spoofing is likely');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\nexport const generateInitialsImage = (name) => {\r\n\tconst canvas = document.createElement('canvas');\r\n\tconst ctx = canvas.getContext('2d');\r\n\tcanvas.width = 100;\r\n\tcanvas.height = 100;\r\n\r\n\tif (!canvasPixelTest()) {\r\n\t\tconsole.log(\r\n\t\t\t'generateInitialsImage: failed pixel test, fingerprint evasion is likely. Using default image.'\r\n\t\t);\r\n\t\treturn '/user.png';\r\n\t}\r\n\r\n\tctx.fillStyle = '#F39C12';\r\n\tctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n\tctx.fillStyle = '#FFFFFF';\r\n\tctx.font = '40px Helvetica';\r\n\tctx.textAlign = 'center';\r\n\tctx.textBaseline = 'middle';\r\n\r\n\tconst sanitizedName = name.trim();\r\n\tconst initials =\r\n\t\tsanitizedName.length > 0\r\n\t\t\t? sanitizedName[0] +\r\n\t\t\t  (sanitizedName.split(' ').length > 1\r\n\t\t\t\t\t? sanitizedName[sanitizedName.lastIndexOf(' ') + 1]\r\n\t\t\t\t\t: '')\r\n\t\t\t: '';\r\n\r\n\tctx.fillText(initials.toUpperCase(), canvas.width / 2, canvas.height / 2);\r\n\r\n\treturn canvas.toDataURL();\r\n};\r\n\r\nexport const copyToClipboard = async (text) => {\r\n\tlet result = false;\r\n\tif (!navigator.clipboard) {\r\n\t\tconst textArea = document.createElement('textarea');\r\n\t\ttextArea.value = text;\r\n\r\n\t\t// Avoid scrolling to bottom\r\n\t\ttextArea.style.top = '0';\r\n\t\ttextArea.style.left = '0';\r\n\t\ttextArea.style.position = 'fixed';\r\n\r\n\t\tdocument.body.appendChild(textArea);\r\n\t\ttextArea.focus();\r\n\t\ttextArea.select();\r\n\r\n\t\ttry {\r\n\t\t\tconst successful = document.execCommand('copy');\r\n\t\t\tconst msg = successful ? 'successful' : 'unsuccessful';\r\n\t\t\tconsole.log('Fallback: Copying text command was ' + msg);\r\n\t\t\tresult = true;\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error('Fallback: Oops, unable to copy', err);\r\n\t\t}\r\n\r\n\t\tdocument.body.removeChild(textArea);\r\n\t\treturn result;\r\n\t}\r\n\r\n\tresult = await navigator.clipboard\r\n\t\t.writeText(text)\r\n\t\t.then(() => {\r\n\t\t\tconsole.log('Async: Copying to clipboard was successful!');\r\n\t\t\treturn true;\r\n\t\t})\r\n\t\t.catch((error) => {\r\n\t\t\tconsole.error('Async: Could not copy text: ', error);\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\treturn result;\r\n};\r\n\r\nexport const compareVersion = (latest, current) => {\r\n\treturn current === '0.0.0'\r\n\t\t? false\r\n\t\t: current.localeCompare(latest, undefined, {\r\n\t\t\t\tnumeric: true,\r\n\t\t\t\tsensitivity: 'case',\r\n\t\t\t\tcaseFirst: 'upper'\r\n\t\t  }) < 0;\r\n};\r\n\r\nexport const findWordIndices = (text) => {\r\n\tconst regex = /\\[([^\\]]+)\\]/g;\r\n\tconst matches = [];\r\n\tlet match;\r\n\r\n\twhile ((match = regex.exec(text)) !== null) {\r\n\t\tmatches.push({\r\n\t\t\tword: match[1],\r\n\t\t\tstartIndex: match.index,\r\n\t\t\tendIndex: regex.lastIndex - 1\r\n\t\t});\r\n\t}\r\n\r\n\treturn matches;\r\n};\r\n\r\nexport const removeFirstHashWord = (inputString) => {\r\n\t// Split the string into an array of words\r\n\tconst words = inputString.split(' ');\r\n\r\n\t// Find the index of the first word that starts with #\r\n\tconst index = words.findIndex((word) => word.startsWith('#'));\r\n\r\n\t// Remove the first word with #\r\n\tif (index !== -1) {\r\n\t\twords.splice(index, 1);\r\n\t}\r\n\r\n\t// Join the remaining words back into a string\r\n\tconst resultString = words.join(' ');\r\n\r\n\treturn resultString;\r\n};\r\n\r\nexport const transformFileName = (fileName) => {\r\n\t// Convert to lowercase\r\n\tconst lowerCaseFileName = fileName.toLowerCase();\r\n\r\n\t// Remove special characters using regular expression\r\n\tconst sanitizedFileName = lowerCaseFileName.replace(/[^\\w\\s]/g, '');\r\n\r\n\t// Replace spaces with dashes\r\n\tconst finalFileName = sanitizedFileName.replace(/\\s+/g, '-');\r\n\r\n\treturn finalFileName;\r\n};\r\n\r\nexport const calculateSHA256 = async (file) => {\r\n\t// Create a FileReader to read the file asynchronously\r\n\tconst reader = new FileReader();\r\n\r\n\t// Define a promise to handle the file reading\r\n\tconst readFile = new Promise((resolve, reject) => {\r\n\t\treader.onload = () => resolve(reader.result);\r\n\t\treader.onerror = reject;\r\n\t});\r\n\r\n\t// Read the file as an ArrayBuffer\r\n\treader.readAsArrayBuffer(file);\r\n\r\n\ttry {\r\n\t\t// Wait for the FileReader to finish reading the file\r\n\t\tconst buffer = await readFile;\r\n\r\n\t\t// Convert the ArrayBuffer to a Uint8Array\r\n\t\tconst uint8Array = new Uint8Array(buffer);\r\n\r\n\t\t// Calculate the SHA-256 hash using Web Crypto API\r\n\t\tconst hashBuffer = await crypto.subtle.digest('SHA-256', uint8Array);\r\n\r\n\t\t// Convert the hash to a hexadecimal string\r\n\t\tconst hashArray = Array.from(new Uint8Array(hashBuffer));\r\n\t\tconst hashHex = hashArray.map((byte) => byte.toString(16).padStart(2, '0')).join('');\r\n\r\n\t\treturn `${hashHex}`;\r\n\t} catch (error) {\r\n\t\tconsole.error('Error calculating SHA-256 hash:', error);\r\n\t\tthrow error;\r\n\t}\r\n};\r\n\r\nexport const getImportOrigin = (_chats) => {\r\n\t// Check what external service chat imports are from\r\n\tif ('mapping' in _chats[0]) {\r\n\t\treturn 'openai';\r\n\t}\r\n\treturn 'webui';\r\n};\r\n\r\nconst convertOpenAIMessages = (convo) => {\r\n\t// Parse OpenAI chat messages and create chat dictionary for creating new chats\r\n\tconst mapping = convo['mapping'];\r\n\tconst messages = [];\r\n\tlet currentId = '';\r\n\tlet lastId = null;\r\n\r\n\tfor (let message_id in mapping) {\r\n\t\tconst message = mapping[message_id];\r\n\t\tcurrentId = message_id;\r\n\t\ttry {\r\n\t\t\tif (\r\n\t\t\t\tmessages.length == 0 &&\r\n\t\t\t\t(message['message'] == null ||\r\n\t\t\t\t\t(message['message']['content']['parts']?.[0] == '' &&\r\n\t\t\t\t\t\tmessage['message']['content']['text'] == null))\r\n\t\t\t) {\r\n\t\t\t\t// Skip chat messages with no content\r\n\t\t\t\tcontinue;\r\n\t\t\t} else {\r\n\t\t\t\tconst new_chat = {\r\n\t\t\t\t\tid: message_id,\r\n\t\t\t\t\tparentId: lastId,\r\n\t\t\t\t\tchildrenIds: message['children'] || [],\r\n\t\t\t\t\trole: message['message']?.['author']?.['role'] !== 'user' ? 'assistant' : 'user',\r\n\t\t\t\t\tcontent:\r\n\t\t\t\t\t\tmessage['message']?.['content']?.['parts']?.[0] ||\r\n\t\t\t\t\t\tmessage['message']?.['content']?.['text'] ||\r\n\t\t\t\t\t\t'',\r\n\t\t\t\t\tmodel: 'gpt-3.5-turbo',\r\n\t\t\t\t\tdone: true,\r\n\t\t\t\t\tcontext: null\r\n\t\t\t\t};\r\n\t\t\t\tmessages.push(new_chat);\r\n\t\t\t\tlastId = currentId;\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log('Error with', message, '\\nError:', error);\r\n\t\t}\r\n\t}\r\n\r\n\tlet history = {};\r\n\tmessages.forEach((obj) => (history[obj.id] = obj));\r\n\r\n\tconst chat = {\r\n\t\thistory: {\r\n\t\t\tcurrentId: currentId,\r\n\t\t\tmessages: history // Need to convert this to not a list and instead a json object\r\n\t\t},\r\n\t\tmodels: ['gpt-3.5-turbo'],\r\n\t\tmessages: messages,\r\n\t\toptions: {},\r\n\t\ttimestamp: convo['create_time'],\r\n\t\ttitle: convo['title'] ?? 'New Chat'\r\n\t};\r\n\treturn chat;\r\n};\r\n\r\nconst validateChat = (chat) => {\r\n\t// Because ChatGPT sometimes has features we can't use like DALL-E or migh have corrupted messages, need to validate\r\n\tconst messages = chat.messages;\r\n\r\n\t// Check if messages array is empty\r\n\tif (messages.length === 0) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Last message's children should be an empty array\r\n\tconst lastMessage = messages[messages.length - 1];\r\n\tif (lastMessage.childrenIds.length !== 0) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// First message's parent should be null\r\n\tconst firstMessage = messages[0];\r\n\tif (firstMessage.parentId !== null) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Every message's content should be a string\r\n\tfor (let message of messages) {\r\n\t\tif (typeof message.content !== 'string') {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\nexport const convertOpenAIChats = (_chats) => {\r\n\t// Create a list of dictionaries with each conversation from import\r\n\tconst chats = [];\r\n\tlet failed = 0;\r\n\tfor (let convo of _chats) {\r\n\t\tconst chat = convertOpenAIMessages(convo);\r\n\r\n\t\tif (validateChat(chat)) {\r\n\t\t\tchats.push({\r\n\t\t\t\tid: convo['id'],\r\n\t\t\t\tuser_id: '',\r\n\t\t\t\ttitle: convo['title'],\r\n\t\t\t\tchat: chat,\r\n\t\t\t\ttimestamp: convo['timestamp']\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tfailed++;\r\n\t\t}\r\n\t}\r\n\tconsole.log(failed, 'Conversations could not be imported');\r\n\treturn chats;\r\n};\r\n\r\nexport const isValidHttpUrl = (string) => {\r\n\tlet url;\r\n\r\n\ttry {\r\n\t\turl = new URL(string);\r\n\t} catch (_) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn url.protocol === 'http:' || url.protocol === 'https:';\r\n};\r\n\r\nexport const removeEmojis = (str) => {\r\n\t// Regular expression to match emojis\r\n\tconst emojiRegex = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDE4F]/g;\r\n\r\n\t// Replace emojis with an empty string\r\n\treturn str.replace(emojiRegex, '');\r\n};\r\n\r\nexport const extractSentences = (text) => {\r\n\t// Split the paragraph into sentences based on common punctuation marks\r\n\tconst sentences = text.split(/(?<=[.!?])/);\r\n\r\n\treturn sentences\r\n\t\t.map((sentence) => removeEmojis(sentence.trim()))\r\n\t\t.filter((sentence) => sentence !== '');\r\n};\r\n\r\nexport const blobToFile = (blob, fileName) => {\r\n\t// Create a new File object from the Blob\r\n\tconst file = new File([blob], fileName, { type: blob.type });\r\n\treturn file;\r\n};\r\n\r\n/**\r\n * @param {string} template - The template string containing placeholders.\r\n * @returns {string} The template string with the placeholders replaced by the prompt.\r\n */\r\nexport const promptTemplate = (\r\n\ttemplate: string,\r\n\tuser_name?: string,\r\n\tcurrent_location?: string\r\n): string => {\r\n\t// Get the current date\r\n\tconst currentDate = new Date();\r\n\r\n\t// Format the date to YYYY-MM-DD\r\n\tconst formattedDate =\r\n\t\tcurrentDate.getFullYear() +\r\n\t\t'-' +\r\n\t\tString(currentDate.getMonth() + 1).padStart(2, '0') +\r\n\t\t'-' +\r\n\t\tString(currentDate.getDate()).padStart(2, '0');\r\n\r\n\t// Replace {{CURRENT_DATE}} in the template with the formatted date\r\n\ttemplate = template.replace('{{CURRENT_DATE}}', formattedDate);\r\n\r\n\tif (user_name) {\r\n\t\t// Replace {{USER_NAME}} in the template with the user's name\r\n\t\ttemplate = template.replace('{{USER_NAME}}', user_name);\r\n\t}\r\n\r\n\tif (current_location) {\r\n\t\t// Replace {{CURRENT_LOCATION}} in the template with the current location\r\n\t\ttemplate = template.replace('{{CURRENT_LOCATION}}', current_location);\r\n\t}\r\n\r\n\treturn template;\r\n};\r\n\r\n/**\r\n * This function is used to replace placeholders in a template string with the provided prompt.\r\n * The placeholders can be in the following formats:\r\n * - `{{prompt}}`: This will be replaced with the entire prompt.\r\n * - `{{prompt:start:<length>}}`: This will be replaced with the first <length> characters of the prompt.\r\n * - `{{prompt:end:<length>}}`: This will be replaced with the last <length> characters of the prompt.\r\n * - `{{prompt:middletruncate:<length>}}`: This will be replaced with the prompt truncated to <length> characters, with '...' in the middle.\r\n *\r\n * @param {string} template - The template string containing placeholders.\r\n * @param {string} prompt - The string to replace the placeholders with.\r\n * @returns {string} The template string with the placeholders replaced by the prompt.\r\n */\r\nexport const titleGenerationTemplate = (template: string, prompt: string): string => {\r\n\ttemplate = template.replace(\r\n\t\t/{{prompt}}|{{prompt:start:(\\d+)}}|{{prompt:end:(\\d+)}}|{{prompt:middletruncate:(\\d+)}}/g,\r\n\t\t(match, startLength, endLength, middleLength) => {\r\n\t\t\tif (match === '{{prompt}}') {\r\n\t\t\t\treturn prompt;\r\n\t\t\t} else if (match.startsWith('{{prompt:start:')) {\r\n\t\t\t\treturn prompt.substring(0, startLength);\r\n\t\t\t} else if (match.startsWith('{{prompt:end:')) {\r\n\t\t\t\treturn prompt.slice(-endLength);\r\n\t\t\t} else if (match.startsWith('{{prompt:middletruncate:')) {\r\n\t\t\t\tif (prompt.length <= middleLength) {\r\n\t\t\t\t\treturn prompt;\r\n\t\t\t\t}\r\n\t\t\t\tconst start = prompt.slice(0, Math.ceil(middleLength / 2));\r\n\t\t\t\tconst end = prompt.slice(-Math.floor(middleLength / 2));\r\n\t\t\t\treturn `${start}...${end}`;\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t}\r\n\t);\r\n\r\n\ttemplate = promptTemplate(template);\r\n\r\n\treturn template;\r\n};\r\n\r\nexport const approximateToHumanReadable = (nanoseconds: number) => {\r\n\tconst seconds = Math.floor((nanoseconds / 1e9) % 60);\r\n\tconst minutes = Math.floor((nanoseconds / 6e10) % 60);\r\n\tconst hours = Math.floor((nanoseconds / 3.6e12) % 24);\r\n\r\n\tconst results: string[] = [];\r\n\r\n\tif (seconds >= 0) {\r\n\t\tresults.push(`${seconds}s`);\r\n\t}\r\n\r\n\tif (minutes > 0) {\r\n\t\tresults.push(`${minutes}m`);\r\n\t}\r\n\r\n\tif (hours > 0) {\r\n\t\tresults.push(`${hours}h`);\r\n\t}\r\n\r\n\treturn results.reverse().join(' ');\r\n};\r\n\r\nexport const getTimeRange = (timestamp) => {\r\n\tconst now = new Date();\r\n\tconst date = new Date(timestamp * 1000); // Convert Unix timestamp to milliseconds\r\n\r\n\t// Calculate the difference in milliseconds\r\n\tconst diffTime = now.getTime() - date.getTime();\r\n\tconst diffDays = diffTime / (1000 * 3600 * 24);\r\n\r\n\tconst nowDate = now.getDate();\r\n\tconst nowMonth = now.getMonth();\r\n\tconst nowYear = now.getFullYear();\r\n\r\n\tconst dateDate = date.getDate();\r\n\tconst dateMonth = date.getMonth();\r\n\tconst dateYear = date.getFullYear();\r\n\r\n\tif (nowYear === dateYear && nowMonth === dateMonth && nowDate === dateDate) {\r\n\t\treturn 'Today';\r\n\t} else if (nowYear === dateYear && nowMonth === dateMonth && nowDate - dateDate === 1) {\r\n\t\treturn 'Yesterday';\r\n\t} else if (diffDays <= 7) {\r\n\t\treturn 'Previous 7 days';\r\n\t} else if (diffDays <= 30) {\r\n\t\treturn 'Previous 30 days';\r\n\t} else if (nowYear === dateYear) {\r\n\t\treturn date.toLocaleString('default', { month: 'long' });\r\n\t} else {\r\n\t\treturn date.getFullYear().toString();\r\n\t}\r\n};\r\n"],"names":["getRandomValues","rnds8","rng","byteToHex","i","unsafeStringify","arr","offset","randomUUID","native","v4","options","buf","rnds","sanitizeResponseContent","content","revertSanitizedResponseContent","splitStream","splitOn","buffer","chunk","controller","parts","part","convertMessagesToHistory","messages","history","parentMessageId","messageId","message","uuidv4","canvasPixelTest","canvas","ctx","imageData","pixelValues","p","generateInitialsImage","name","sanitizedName","initials","copyToClipboard","text","result","textArea","msg","err","error","compareVersion","latest","current","findWordIndices","regex","matches","match","removeFirstHashWord","inputString","words","index","word","transformFileName","fileName","getImportOrigin","_chats","convertOpenAIMessages","convo","mapping","currentId","lastId","message_id","_a","new_chat","_c","_b","_f","_e","_d","_h","_g","obj","validateChat","chat","convertOpenAIChats","chats","failed","isValidHttpUrl","string","url","removeEmojis","str","emojiRegex","extractSentences","sentence","blobToFile","blob","promptTemplate","template","user_name","current_location","currentDate","formattedDate","titleGenerationTemplate","prompt","startLength","endLength","middleLength","start","end","approximateToHumanReadable","nanoseconds","seconds","minutes","hours","results","getTimeRange","timestamp","now","date","diffDays","nowDate","nowMonth","nowYear","dateDate","dateMonth","dateYear"],"mappings":"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","x_google_ignoreList":[0,1,2,3]}